---
title: "Cody"
author: "Cody Spiegel"
date: "4/22/2022"
output: word_document
---

```{r setup chunk, setup, include = FALSE, cache=FALSE, message=FALSE, warning=FALSE}
if (!require('knitr')) install.packages('knitr'); library('knitr')
knitr::opts_chunk$set(warning=FALSE, message=FALSE, fig.align='center')

# load packages
if (!require("pacman")) install.packages("pacman") # for rapid install if not in library

# use pacman to load all the packages you are missing!
pacman::p_load('knitr', 'lme4', 'lmerTest', 'tidyverse', 'magrittr', 'effects', 'plyr', 'dplyr', 
               'plotrix', 'car',"gridExtra", "cowplot", "tools")
Fig.formatting<-(theme_classic()) +
  theme(text=element_text(size=14),
        legend.text.align = 0,
        panel.border = element_rect(fill=NA, colour = "black", size=1),
        aspect.ratio=1, 
        axis.ticks.length=unit(0.25, "cm"),
        axis.text.y=element_text(
        margin=unit(c(0.5, 0.5, 0.5, 0.5), "cm"), colour="black", size=12), 
        axis.text.x=element_text(
        margin=unit(c(0.5, 0.5, 0.5, 0.5), "cm"), colour="black", size=12)) +
  theme(legend.key.size = unit(0.4, "cm")) +
  theme(aspect.ratio=1.3) +
  theme(panel.spacing=unit(c(0, 0, 0, 0), "cm"))


```

###DOC  
import and do a loop to clean up all files and make stacked data in single df
```{r}
## import treatment IDs
IDs<-read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/treatment.IDs.csv")

##### grab files in a list
Total.DOC.files <- list.files(path="/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/DOC.TN", pattern = "csv$", full.names = T)
Total.DOC.files
##### what are the file names, sans extensions using package 'tools'
file.names<-file_path_sans_ext(list.files(path="/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/DOC.TN", pattern = "csv$", full.names = F))
file.names

############ formatting all data in for loop
  for(i in 1:length(Total.DOC.files))
    {
  data<-read.csv(Total.DOC.files[i], sep=",")
  data<-data[,c(1,3,4)] # removed columns we don't need
  data$File<-Total.DOC.files[i]
  colnames(data)<-c("Tank", "DOC..mg.L", "TN..mg.L", "File")
  data$Tank<- IDs$Tank
  data$Tank<-as.numeric(as.character(data$Tank)) # make the column of samples all numeric
  data <- data[!is.na(as.numeric(as.character(data$Tank))),] # remove all rows that aren't numeric/tanks
  data$Treatment<-IDs$Treatment
  data$plant.mass..g<-IDs$plant.mass..g
  make.names(assign(paste(file.names[i], sep=""), data)) # make the file name the name of new df for loop df
  }

########## this is the end of the loop

#Combine files from loop to single df
DOC.df<-rbind(DOC_T0, DOC_T1, DOC_T2, DOC_T3, DOC_T4)
DOC.df2=rbind(DOC_T1, DOC_T2, DOC_T3, DOC_T4)
DOC.df$Treatment=as.factor(DOC.df$Treatment)
DOC.df2$Treatment=as.factor(DOC.df2$Treatment)

#Extract file
DOC.df$File=sapply(strsplit(DOC.df$File, "/"), `[`, 9)
DOC.df2$File=sapply(strsplit(DOC.df2$File, "/"), `[`, 9)

# alternative way to code the above
#give the 10th-24th character of the file name, removing the rest
#DOC.df$File<-substr(DOC.df$File, 13, 27) 

#alternatively
# remove the 9 letters ('^.) at start 
# remove the 4 letters (.$') at end
#DOC.df$File<-gsub('^.........|....$', '', DOC.df$File) 

# if equals DOC_T0 then, T0, if not then T1..etc
DOC.df$Time.point<- as.factor(ifelse(DOC.df$File=="DOC_T0.csv", "T0",
         ifelse (DOC.df$File=="DOC_T1.csv", "T1",
           ifelse (DOC.df$File=="DOC_T2.csv", "T2", 
                   ifelse(DOC.df$File=="DOC_T3.csv", "T3", "T4")))))

DOC.df2$Time.point<- as.factor(
         ifelse (DOC.df2$File=="DOC_T1.csv", "T1",
           ifelse (DOC.df2$File=="DOC_T2.csv", "T2", 
                   ifelse(DOC.df2$File=="DOC_T3.csv", "T3", "T4"))))

#rearrange
library(dplyr)
DOC.df<- DOC.df %>% 
  dplyr::select(File, Time.point, Treatment, Tank, plant.mass..g, DOC..mg.L, TN..mg.L) 

DOC.df2<- DOC.df2 %>% 
  dplyr::select(File, Time.point, Treatment, Tank, plant.mass..g, DOC..mg.L, TN..mg.L) 


#visualize
ggplot(DOC.df, aes(x = plant.mass..g, y = DOC..mg.L, colour = Treatment)) +
    geom_point() +
    facet_grid(~Time.point)+
    geom_smooth(method = 'loess', se = FALSE) 

#x axis time
#y doc
#shape treatment
#color mass
DOC.df2=mutate(DOC.df2, oTreatment= ordered(Treatment, levels= c("burned", "unburned")))
DOC.df2=mutate(DOC.df2, oTime.point= ordered(Time.point, levels= c("T1", "T2", "T3", "T4")))
DOC.df2$oTreatment=as.factor(DOC.df2$oTreatment)
DOC.df2$oTime.point=as.factor(DOC.df2$oTime.point)

mean(DOC_T1[DOC_T1$Treatment=="burned",]$DOC..mg.L)
mean(DOC_T3[DOC_T3$Treatment=="burned",]$DOC..mg.L)

mean(DOC_T1[DOC_T1$Treatment=="unburned",]$DOC..mg.L)
mean(DOC_T3[DOC_T3$Treatment=="unburned",]$DOC..mg.L)


```
DOC plots: biomass is a proxy for DOC 
```{r}
library(ggtext)
library(mgcv)

  theme_cowplot(12)
    theme(legend.title=element_blank())

DOC.T0<-ggplot(DOC.df[(DOC.df$Time.point=="T0"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) +
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-0") +
  xlab("")+
  ylab("DOC concentration (mg/L)")+
  Fig.formatting



DOC.T1<-ggplot(DOC.df[(DOC.df$Time.point=="T1"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
  coord_cartesian(ylim=c(0, 60)) +
  Fig.formatting

DOC.T1




DOC.T2<-ggplot(DOC.df[(DOC.df$Time.point=="T2"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-2") +
  xlab("Plant mass (g)") +
  ylab("")+
  coord_cartesian(ylim=c(0, 60)) +
    Fig.formatting


  
DOC.T3<-ggplot(DOC.df[(DOC.df$Time.point=="T3"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
    Fig.formatting



DOC.T4<-ggplot(DOC.df[(DOC.df$Time.point=="T4"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
    Fig.formatting



extract.legend <- get_legend(
  # create some space to the left of the legend
  DOC.T0 + theme(legend.box.margin = margin(0, 0, 0, 10)))


DOC.plots<-plot_grid(
  DOC.T0+ theme(legend.position = "none"),
  DOC.T1+ theme(legend.position = "none"),
  DOC.T2+ theme(legend.position = "none"),
  DOC.T3+ theme(legend.position = "none"),
  DOC.T4+ theme(legend.position = "none"),
  extract.legend,
  rel_widths = c(50,50,50,50, 50, 20), ncol=6)

DOC.plots=DOC.plots+labs(tag = "A")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")

DOC.plots

ggsave("figures/DOC.concentration.pdf", height=5, width=17.5)


plot_grid(
  ggdraw(add_sub(DOC.plots, "Fig 3. Measured dissolved organic carbon (DOC) concentrations across five sampling periods. Color and line type included to distinguish individual plant trends. Time-0 represents baseline DOC concentrations before the addition of plant material with Time-1 (p< 0.49), Time-2 (p= 0.83), Time-3 (p< 0.01), and Time-4 were sampled for both treatments in November 2021, December 2021, January 2022, and February 2022, respectively. ", x=0.01, hjust=0)), ncol = 1)




```

Total N plots
```{r}
TN.T0<-ggplot(DOC.df[(DOC.df$Time.point=="T0"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) +
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-0") +
  xlab("")+
  ylab("TDN concentration (mg/L)")+
  Fig.formatting+
  coord_cartesian(ylim = c(0,1.5))

 
TN.T1<-ggplot(DOC.df[(DOC.df$Time.point=="T1"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) +
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
  Fig.formatting+
  coord_cartesian(ylim = c(0,1.5))
  
 
TN.T2<-ggplot(DOC.df[(DOC.df$Time.point=="T2"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) +
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-2") +
  xlab("Plant mass (g)")+
  ylab("")+
  Fig.formatting+
  coord_cartesian(ylim = c(0,1.5))

 

TN.T3<-ggplot(DOC.df[(DOC.df$Time.point=="T3"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) +
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
  Fig.formatting+
  coord_cartesian(ylim = c(0,1.5))
 

TN.T4<-ggplot(DOC.df[(DOC.df$Time.point=="T4"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) +
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~ s(x), aes(fill=Treatment), alpha=0.3) +
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
  Fig.formatting+
  coord_cartesian(ylim = c(0,1.5))
  
TN.plots<-plot_grid(
  TN.T0+ theme(legend.position = "none"),
  TN.T1+ theme(legend.position = "none"),
  TN.T2+ theme(legend.position = "none"),
  TN.T3+ theme(legend.position = "none"),
  TN.T4+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(50,50,50,50,50,20), ncol=6)

TN.plots=TN.plots+labs(tag = "B")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")



ggsave("figures/TN.concentration.pdf", height=5, width=17.5)

```

Combined DOC/TN plots

```{r}

DOC.TN.plots= plot_grid(DOC.plots, TN.plots, nrow=2)

DOC.TN.plots

ggsave("figures/DOC.TN.plots.pdf", height=7, width=14.5)



```


DOC analysis: 
T1 model
```{r}
library(mgcv)
library(gratia)
library(car)
m1.gam=gam(DOC..mg.L ~ Treatment + s(plant.mass..g, by= Treatment), subset = Time.point=="T1", data = DOC.df2, method = "REML")


AIC(m1.gam, m1.gam.wo)

anova(m1.gam)
summary(m1.gam)
anova.gam(m1.gam)
gam.check(m1.gam, rep=1000)
draw(m1.gam)
concrvity(m1.gam)
par(mfrow = c(1, 2))
plot(m1.gam, all.terms = TRUE, page=1)

#CI
ci <- confint(m1.gam, type = "confidence")
head(ci)
```
DOC varies non-linearly across the plant mass gradient, with highest levels of DOC in intermediate/high mass tanks.

There is also a pronounced difference in DOC between the treatment, with high levels in unburned, compared to burned.

T2 model
```{r}
m2.gam=gam(DOC..mg.L ~ Treatment + s(plant.mass..g, by=Treatment), subset = Time.point=="T2", data = DOC.df2, method = "REML")

m2.gam.wo=gam(DOC..mg.L ~ s(plant.mass..g, by= Treatment), subset = Time.point=="T2", data = DOC.df2, method = "REML")



AIC(m2.gam, m2.gam.wo)

summary(m2.gam)
anova.gam(m2.gam)
gam.check(m2.gam, rep=1000)
draw(m2.gam)
concrvity(m2.gam)
par(mfrow = c(1, 2))
plot(m2.gam, all.terms = TRUE, page=1)
```
DOC varies non-linearly across the plant mass gradient, with highest levels of DOC in intermediate/high mass tanks still.

There is also no difference in DOC between the treatment.


T3 model
```{r}
m3.gam=gam(DOC..mg.L ~ Treatment + s(plant.mass..g, by=Treatment), subset = Time.point=="T3", data = DOC.df2, method = "REML")
summary(m3.gam)
anova.gam(m3.gam)
gam.check(m3.gam, rep=1000)
draw(m3.gam)
concrvity(m3.gam)
par(mfrow = c(1, 2))
plot(m3.gam, all.terms = TRUE, page=1)
```
DOC varies non-linearly across the plant mass gradient, with highest levels of DOC in intermediate/high mass tanks still.

There is also significant difference in DOC between the treatment, with highest level in the burned treatment compared to the unburned.


T4 model
```{r}
m4.gam=gam(DOC..mg.L ~ Treatment + s(plant.mass..g, by=Treatment), subset = Time.point=="T4", data = DOC.df2, method = "REML")
summary(m4.gam)
anova.gam(m4.gam)
gam.check(m4.gam, rep=1000)
draw(m4.gam)
concrvity(m4.gam)
par(mfrow = c(1, 2))
plot(m4.gam, all.terms = TRUE, page=1)
```
DOC varies non-linearly across the plant mass gradient, with highest levels of DOC in intermediate/high mass tanks still.

There is also significant difference in DOC between the treatment, with highest level in the burned treatment compared to the unburned.


```{r}
m.treatment.gam=gam(DOC..mg.L~Treatment + s(plant.mass..g), subset = Time.point=="T1", data=DOC.df2)
summary(m.treatment.gam)
anova(m.treatment.gam)

m.treatment.gam2=gam(DOC..mg.L~Treatment + s(plant.mass..g), subset = Time.point=="T2", data=DOC.df2)
summary(m.treatment.gam)
anova(m.treatment.gam2)

#box plots of DOC
DOC.boxplot=ggplot(DOC.df, aes(x=Treatment , y=DOC..mg.L, fill=Treatment)) +
  geom_boxplot(aes(fill=Treatment))+
  facet_grid(~Time.point)+
  scale_fill_manual(values = c("orange", "purple")) + 
  xlab("Treatment")+
  ylab("DOC concentration (mg/L)")+
  theme_cowplot(12)+
  theme(legend.title=element_blank())
  


```


T2 model
```{r}
m1.TN.gam=gam(TN..mg.L ~ Treatment + s(plant.mass..g, by=Treatment), subset = Time.point=="T1", data = DOC.df2, method = "REML")
summary(m1.TN.gam)
anova.gam(m1.TN.gam)
gam.check(m1.TN.gam, rep=1000)
draw(m1.TN.gam)
concrvity(m1.TN.gam)


```
T2 model
```{r}
m2.TN.gam=gam(log10(TN..mg.L) ~ Treatment + s(plant.mass..g,by=Treatment, k=4, bs="ps"), subset = Time.point=="T2", data = DOC.df2, method = "REML")
summary(m2.TN.gam)
anova.gam(m2.TN.gam)
gam.check(m2.TN.gam, rep=1000)
draw(m2.TN.gam)
concrvity(m2.TN.gam)


```

T3 model
```{r}
m3.TN.gam=gam(log10(TN..mg.L) ~ Treatment + s(plant.mass..g,by=Treatment, k=4, bs="ps"), subset = Time.point=="T3", data = DOC.df2, method = "REML")
summary(m3.TN.gam)
anova.gam(m3.TN.gam)
gam.check(m3.TN.gam, rep=1000)
draw(m3.TN.gam)
concrvity(m3.TN.gam)


```

T4 model
```{r}
m4.TN.gam=gam(log10(TN..mg.L) ~ Treatment + s(plant.mass..g,by=Treatment, k=4, bs="ps"), subset = Time.point=="T4", data = DOC.df2, method = "REML")
summary(m4.TN.gam)
anova.gam(m4.TN.gam)
gam.check(m4.TN.gam, rep=1000)
draw(m4.TN.gam)
concrvity(m4.TN.gam)


```

UVBIO files
```{r}
##### grab files in a list
UVBio.files <- list.files(path="/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/UVBIO", pattern = "csv$", full.names = T)
UVBio.files

##### what are the file names, sans extensions using package 'tools'
file.names<-file_path_sans_ext(list.files(path="/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/UVBIO", pattern = "csv$", full.names = F))
file.names


############ formatting all data in for loop
  for(i in 1:length(UVBio.files))
    {
  data<-read.csv(UVBio.files[i], sep=",") #skip 13 rows where standards are
  data<-data[,c(1,3,4)] # removed columns we don't need
  data$File<-UVBio.files[i]
  colnames(data)<-c("Tank", "DOC..mg.L", "TN..mg.L", "File") 
  data$Tank<-as.character(data$Tank)
  data$Treatment<-IDs$Treatment # add treatment info
  data$plant.mass..g<-IDs$plant.mass..g # add plant biomass info
  make.names(assign(paste(file.names[i], sep=""), data)) # make the file name the name of new df for loop df
  }
########## this is the end of the loop

ls() #see all dfs you've made, the above will be df matching their file names

#Combine files from loop to single df
UVBIO.df<-rbind(DOC_NoUV_T1, DOC_UV_T1, DOC_NoUV_T2, DOC_UV_T2, DOC_NoUV_T3, DOC_UV_T3)

# make new factors for filtered (F/NF) and UV (+/-)
# ** caution! Make sure this matches sheet layout after the loop!

UVBIO.df$Filter.Trt<-rep(c("Filtered", "Unfiltered"), each=30) # repeat 30 times
UVBIO.df$UV.Trt<-rep(c("NoUV", "UV"), each=60) # repeat 60 times

# check tank names in DF and make sure they are what you think they are (i.e 1-30 but w/ weird names)
Tank.fix<-rep(c(1:30), times=12) # repeat 12 times to fix all the strange tank names 

#compare tank IDS
df.test<-cbind(Tank.fix, UVBIO.df$Tank) # yep!

UVBIO.df$Tank<-as.factor(Tank.fix) #replace old tank names

# extract out the file names
#Extract file
UVBIO.df$File=sapply(strsplit(UVBIO.df$File, "/"), `[`, 9)
#take out redundancies
UVBIO.df$DOC..mg.L<-gsub("NPOC:","", UVBIO.df$DOC..mg.L)
UVBIO.df$DOC..mg.L<- gsub("mg/L", "", UVBIO.df$DOC..mg.L)
UVBIO.df$TN..mg.L<-gsub("TN:","", UVBIO.df$TN..mg.L)
UVBIO.df$TN..mg.L<- gsub("mg/L", "", UVBIO.df$TN..mg.L)

#convert DOC and TN to numeric
UVBIO.df$DOC..mg.L<-as.numeric(as.character(UVBIO.df$DOC..mg.L))
UVBIO.df$TN..mg.L<- as.numeric(as.character(UVBIO.df$TN..mg.L))

# add a time point
# if equals DOC_UV_T1_111721 then, T1, if not then "nothing"
UVBIO.df$Time.point<- as.factor(ifelse(UVBIO.df$File=="DOC_UV_T1.csv", "T1",
  ifelse(UVBIO.df$File=="DOC_NoUV_T1.csv", "T1",
          ifelse(UVBIO.df$File=="DOC_UV_T2.csv", "T2",
                ifelse(UVBIO.df$File=="DOC_NoUV_T2.csv", "T2", "T3")))))

#rearrange
UVBIO.df<- UVBIO.df %>% 
  dplyr::select(File, Time.point, Treatment, Filter.Trt, UV.Trt, Tank, plant.mass..g, DOC..mg.L, TN..mg.L)


# make levels for plotting and stats
# add in starting DOC and TN
# original data is... DOC_T0, DOC_T1, DOC_T2, DOC_T3, DOC_T4 -- but no need for DOC T0 and T4
# repeat 4x to account for the 4 treatments in each tank
DOC_T1.start<-rep(DOC_T1$DOC..mg.L, times=4)
DOC_T2.start<-rep(DOC_T2$DOC..mg.L, times=4)
DOC_T3.start<-rep(DOC_T3$DOC..mg.L, times=4)

TN_T1.start<-rep(DOC_T1$TN..mg.L, times=4)
TN_T2.start<-rep(DOC_T2$TN..mg.L, times=4)
TN_T3.start<-rep(DOC_T3$TN..mg.L, times=4)

# compile and add in as a new column
UVBIO.df$Start.DOC<-c(DOC_T1.start, DOC_T2.start, DOC_T3.start)
UVBIO.df$Start.TN<-c(TN_T1.start, TN_T2.start, TN_T3.start)

UVBIO.df$Burn.Filt.UV<-interaction(UVBIO.df$Treatment, UVBIO.df$Filter.Trt, UVBIO.df$UV.Trt)
UVBIO.df$Filt.UV<-interaction(UVBIO.df$Filter.Trt, UVBIO.df$UV.Trt)

```

Calculate photo, microbe, and total degradation:
```{r}
#+UV/+Bio=A
#-UV/+Bio=B
#+UV/-Bio=C
#-UV/-Bio (NoUV,Filtered)=D

#This is calculating % decrease ((control-treatment)/control)*100

#photodegradation

photo.df=data.frame(UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Time.point,
                    UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.DOC,
                    UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.TN,
                    UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Treatment,
                    UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Tank,
                    UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$plant.mass..g,
                    UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$DOC..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.DOC,
                    100*(UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$DOC..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.DOC)/((UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.DOC)), 
                     UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$TN..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.TN,
                    100*(UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$TN..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.TN)/((UVBIO.df[UVBIO.df$Filt.UV=="Filtered.UV",]$Start.TN)))

photo.df$type="UV"
names(photo.df)[1]="Time.point"
names(photo.df)[2]="Start.DOC"
names(photo.df)[3]="Start.TN"
names(photo.df)[4]="Treatment"
names(photo.df)[5]="Tank"
names(photo.df)[6]="plant.mass..g"
names(photo.df)[7]="abs.change.DOC"
names(photo.df)[8]="percent.change.DOC"
names(photo.df)[9]="abs.change.TN"
names(photo.df)[10]="percent.change.TN"
photo.df$mass.remaining.DOC=100-abs(photo.df[photo.df$type=="UV",]$percent.change.DOC)
photo.df$mass.remaining.TN=100-abs(photo.df[photo.df$type=="UV",]$percent.change.TN)


#Microbe decomp
microbe.df=data.frame(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Time.point,
                      UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.DOC,
                      UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.TN,
                      UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Treatment,
                      UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Tank,
                      UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$plant.mass..g,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$DOC..mg.L- UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.DOC,
                    100*(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$DOC..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.DOC)/(( UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.DOC)),
                     UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$TN..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.TN,
                    100*(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$TN..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.TN)/((UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.NoUV",]$Start.TN)))

microbe.df$type="microbe"
names(microbe.df)[1]="Time.point"
names(microbe.df)[2]="Start.DOC"
names(microbe.df)[3]="Start.TN"
names(microbe.df)[4]="Treatment"
names(microbe.df)[5]="Tank"
names(microbe.df)[6]="plant.mass..g"
names(microbe.df)[7]="abs.change.DOC"
names(microbe.df)[8]="percent.change.DOC"
names(microbe.df)[9]="abs.change.TN"
names(microbe.df)[10]="percent.change.TN"
microbe.df$mass.remaining.DOC=100-abs(microbe.df[microbe.df$type=="microbe",]$percent.change.DOC)
microbe.df$mass.remaining.TN=100-abs(microbe.df[microbe.df$type=="microbe",]$percent.change.TN)


#Total decomp= A
total.df=data.frame(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Time.point,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.DOC,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.TN,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Treatment,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Tank,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$plant.mass..g,
                    UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$DOC..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.DOC,
                     100*(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$DOC..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.DOC)/(abs(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.DOC)),
                      UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$TN..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.TN,
                     100*(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$TN..mg.L-UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.TN)/(abs(UVBIO.df[UVBIO.df$Filt.UV=="Unfiltered.UV",]$Start.TN)))
                     
total.df$type="microbe+UV"
names(total.df)[1]="Time.point"
names(total.df)[2]="Start.DOC"
names(total.df)[3]="Start.TN"
names(total.df)[4]="Treatment"
names(total.df)[5]="Tank"
names(total.df)[6]="plant.mass..g"
names(total.df)[7]="abs.change.DOC"
names(total.df)[8]="percent.change.DOC"
names(total.df)[9]="abs.change.TN"
names(total.df)[10]="percent.change.TN"
total.df$mass.remaining.DOC=100-abs(total.df[total.df$type=="microbe+UV",]$percent.change.DOC)
total.df$mass.remaining.TN=100-abs(total.df[total.df$type=="microbe+UV",]$percent.change.TN)



#merge degra.df time points into one dataframe
degra.df=rbind(photo.df, microbe.df, total.df)
degra.df=pivot_longer(degra.df, cols=c("type"), names_to="type", values_to="Effect")

#make sure we have factors
degra.df=degra.df%>%
    mutate_if(is.character,as.factor)

#arcsine transform for later analysis
degra.df$mass.remaining.dec=degra.df$mass.remaining/100
degra.df$mass.remaining.arc=asin(sqrt(degra.df$mass.remaining.dec))


```

UVBIO % Change Plots
```{r}
#Unburned treatment degradation
unburned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="unburned"),])+ 
   geom_point(aes(x=Start.DOC,y=percent.change.DOC,color=effect),alpha=0.5)+
  geom_smooth(aes(x=Start.DOC, y=percent.change.DOC, color=effect), method="loess", alpha=0.1)+
  facet_grid(~Time.point, scales = "free_x")+
  scale_color_manual(values = c("magenta", "springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: unburned") +
  ylab(expression(paste("%", Delta, " DOC mg/L"))) +
  xlab("Initial DOC (mg/L)")+
  coord_cartesian(ylim=c(-40, 100))+
  theme_cowplot(12)
unburned.degra.plot

extract.legend2 <- get_legend(
  # create some space to the left of the legend
  unburned.degra.plot + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))


#Burned degradation
burned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="burned"),])+ 
   geom_point(aes(x=Start.DOC,y=percent.change.DOC,color=effect),alpha=0.5)+
  geom_smooth(aes(x=Start.DOC, y=percent.change.DOC, color=effect), method="loess", alpha=0.1)+
  facet_grid(~Time.point, scales = "free_x" )+
  scale_color_manual(values = c("magenta", "springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: burned") +
  xlab("Initial DOC (mg/L)")+
  ylab(expression(paste("%", Delta, " DOC mg/L"))) +
  coord_cartesian(ylim=c(-40, 100))+
  theme_cowplot(12)
burned.degra.plot

#combine them
degra.plots=plot_grid(unburned.degra.plot + theme(legend.position = "none",legend.title=element_blank()),
          burned.degra.plot + theme(legend.position = "none"),
          extract.legend2,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(10,10,3))
degra.plots

plot_grid(
  ggdraw(add_sub(degra.plots, "Fig 2. Three degradation pathways of dissolved organic carbon (DOC) concentrations across three time points during a seven \nday incubation period for each treatment. \n'Microbe' represents the change in DOC due to microbial degradation, 'photo' represents the change in DOC due to photodegradation, and 'total' represents the change in \nDOC due to both microbial and photodegradation.", x=0.01, hjust=0)), ncol = 1)


ggsave("figures/UVBio.perc.degra_type.plots.pdf", height=5, width=15)
```

UVBIO % mass remaining plot
```{r}
#Unburned treatment degradation
mass.unburned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="unburned"),])+ 
   geom_point(aes(x=plant.mass..g,y=mass.remaining,color=effect),alpha=0.5)+
  geom_smooth(aes(x=plant.mass..g, y=mass.remaining, color=effect), method="loess", alpha=0.1)+
  facet_grid(~Time.point)+
  scale_color_manual(values = c("magenta", "springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: unburned") +
  ylab(expression(paste("% DOC remaining (mg/L)"))) +
  xlab("Plant Mass (g)")+
  coord_cartesian(ylim = c(10,150))+
  theme_cowplot(12)+
  theme(legend.title=element_blank())



extract.legend2 <- get_legend(
  # create some space to the left of the legend
  mass.unburned.degra.plot + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))


#Burned degradation
mass.burned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="burned"),])+ 
   geom_point(aes(x=plant.mass..g,y=mass.remaining,color=effect),alpha=0.5)+
  geom_smooth(aes(x=plant.mass..g, y=mass.remaining, color=effect), method="loess", alpha=0.1)+
  facet_grid(~Time.point)+
  scale_color_manual(values = c("magenta", "springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: burned") +
  xlab("plant material (g)")+
  ylab(expression(paste("% DOC remaining (mg/L)"))) +
  theme_cowplot(12)


#combine them
mass.degra.plots=plot_grid(mass.unburned.degra.plot + theme(legend.position = "none", legend.title=element_blank()), mass.burned.degra.plot + theme(legend.position = "none"),
          extract.legend2,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(15,15,3))
mass.degra.plots

plot_grid(
  ggdraw(add_sub(mass.degra.plots, "Fig 2. Three degradation pathways of dissolved organic carbon (DOC) across three time points during a seven \nday incubation period for both treatments. Values indicate % DOC remaining with 'microbe' representing \nmicrobial degradation, 'photo' representing photodegradation, and 'total' representing both microbial and \nphotodegradation. All positive values indiciate % DOC increase.", x=0.01, hjust=0)), ncol = 1)


ggsave("figures/UVBio.mass.degra_type.plots.pdf", height=5, width=10)


```


UVBIO DOC with just Time-1
```{r}

UVBIO.T1.DOC<-ggplot(degra.df[(degra.df$Time.point=="T1"),], aes(x=plant.mass..g, y=percent.change.DOC, color=Effect, linetype=Treatment))+
 guides(linetype = guide_legend(override.aes = list(color = "black")))+
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("red", "midnightblue", "yellow")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Effect), alpha=0.2) +
  ylab(expression(paste("Change DOC (%)")))+
  xlab("Plant mass (g)")+
  theme(legend.title = "none")+
  Fig.formatting

UVBIO.T1.DOC=UVBIO.T1.DOC +labs(tag = "A")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")


extract.legend.uvbio=get_legend(
  # create some space to the left of the legend
  UVBIO.T1.DOC + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))

UVBIO.T1.DOC.treatment<-ggplot(degra.df[(degra.df$Time.point=="T1"),], aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment))+
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.2) +
  ylab(expression(paste("Change DOC (%)")))+
  xlab("Plant mass (g)")+
  Fig.formatting

UVBIO.T1.DOC.treatment=UVBIO.T1.DOC.treatment + labs(tag = "B")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")


plot_grid(UVBIO.T1.DOC, 
          UVBIO.T1.DOC.treatment, 
          nrow=2)


ggsave("figures/T1.degra.combo.plot.pdf", height=8, width=5)

```

UVBIO with just T1
```{r}

UVBIO.T1.TN<-ggplot(degra.df[(degra.df$Time.point=="T1"),], aes(x=plant.mass..g, y=percent.change.TN, color=Effect, linetype=Treatment))+
 guides(linetype = guide_legend(override.aes = list(color = "black")))+
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("red", "midnightblue", "yellow")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Effect), alpha=0.2) +
  ylab(expression(paste("Change TDN (%)")))+
  xlab("Plant mass (g)")+
  theme(legend.title = "none")+
  Fig.formatting

UVBIO.T1.TN=UVBIO.T1.TN +labs(tag = "A")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")


UVBIO.T1.TN.treatment<-ggplot(degra.df[(degra.df$Time.point=="T1"),], aes(x=plant.mass..g, y=percent.change.TN, color=Treatment))+
  geom_point(alpha=0.4) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.2) +
  ylab(expression(paste("Change TDN (%)")))+
  xlab("Plant mass (g)")+
  Fig.formatting

UVBIO.T1.TN.treatment=UVBIO.T1.TN.treatment + labs(tag = "B")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")


plot_grid(UVBIO.T1.TN, 
          UVBIO.T1.TN.treatment, 
          nrow=2)


ggsave("figures/T1.degra.combo.TN.plot.pdf", height=8, width=5)


```

UVBIO % mass remaining plot with start DOC
```{r}
#Unburned treatment degradation
mass.unburned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="unburned"),])+ 
   geom_point(aes(x=Start.DOC,y=mass.remaining,color=effect),alpha=0.5)+
  geom_smooth(aes(x=Start.DOC, y=mass.remaining, color=effect), method="gam", formula = y ~ s(x), alpha=0.1)+
  facet_grid(~Time.point, scales = "free")+
  scale_color_manual(values = c("springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: unburned") +
  ylab(expression(paste("% DOC remaining (mg/L)"))) +
  xlab("Initial DOC (mg/L)")+
  theme_cowplot(12)+
  theme(legend.title=element_blank())



extract.legend2 <- get_legend(
  # create some space to the left of the legend
  mass.unburned.degra.plot + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))


#Burned degradation
mass.burned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="burned"),])+ 
   geom_point(aes(x=Start.DOC,y=mass.remaining,color=effect),alpha=0.5)+
  geom_smooth(aes(x=Start.DOC, y=mass.remaining, color=effect), method="gam", formula = y ~ s(x), alpha=0.1)+
  facet_grid(~Time.point, scales = "free")+
  scale_color_manual(values = c("springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: burned") +
  xlab("Initial DOC (mg/L)")+
  ylab(expression(paste("% DOC remaining (mg/L)"))) +
  theme_cowplot(12)


#combine them
mass.degra.plots=plot_grid(mass.unburned.degra.plot + theme(legend.position = "none", legend.title=element_blank()), mass.burned.degra.plot + theme(legend.position = "none"),
          extract.legend2,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(15,15,3))

mass.degra.plots

plot_grid(
  ggdraw(add_sub(mass.degra.plots, "Fig 2. Three degradation pathways of dissolved organic carbon (DOC) across three time points during a seven \nday incubation period for both treatments. Values indicate % DOC remaining with 'microbe' representing \nmicrobial degradation, 'photo' representing photodegradation, and 'total' representing both microbial and \nphotodegradation. All positive values indiciate % DOC increase.", x=0.01, hjust=0)), ncol = 1)


ggsave("figures/UVBio.mass.degra_type.plots.pdf", height=5, width=10)


```


Looking at tank 22
```{r}

#Unburned treatment degradation
mass.unburned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="unburned"),])+ 
   geom_point(aes(x=plant.mass..g,y=abs.change.DOC, color=effect),alpha=0.5)+
  geom_smooth(aes(x=plant.mass..g, y=abs.change.DOC, color=effect), method="gam", formula= y~x + s(x), alpha=0.1)+
  facet_grid(~Time.point)+
  scale_color_manual(values = c("magenta", "springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: unburned") +
  ylab(expression(paste(Delta, "DOC (mg/L)"))) +
  xlab("Initial DOC (mg/L)")+
  theme_cowplot(12)+
  theme(legend.title=element_blank())



extract.legend2 <- get_legend(
  # create some space to the left of the legend
  mass.unburned.degra.plot + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))


#Burned degradation
mass.burned.degra.plot=ggplot(degra.df[(degra.df$Treatment=="burned"),])+ 
   geom_point(aes(x=plant.mass..g,y=abs.change.DOC,color=effect),alpha=0.5)+
  geom_smooth(aes(x=plant.mass..g, y=abs.change.DOC, color=effect), method="gam",formula= y~x + s(x), alpha=0.1)+
  facet_grid(~Time.point)+
  scale_color_manual(values = c("magenta", "springgreen1", "gold", "midnightblue")) + 
  ggtitle("Degradation: burned") +
  xlab("Initial DOC (mg/L)")+
  ylab(expression(paste(Delta, "DOC (mg/L)"))) +
  theme_cowplot(12)

mass.burned.degra.plot


#combine them
mass.degra.plots=plot_grid(mass.unburned.degra.plot + theme(legend.position = "none", legend.title=element_blank()), mass.burned.degra.plot + theme(legend.position = "none"),
          extract.legend2,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(15,15,3))

mass.degra.plots

plot_grid(
  ggdraw(add_sub(mass.degra.plots, "Fig 2. Three degradation pathways of dissolved organic carbon (DOC) across three time points during a seven \nday incubation period for both treatments. Values indicate % DOC remaining with 'microbe' representing \nmicrobial degradation, 'photo' representing photodegradation, and 'total' representing both microbial and \nphotodegradation. All positive values indiciate % DOC increase.", x=0.01, hjust=0)), ncol = 1)


ggsave("figures/GAM.UVBio.mass.degra_type.plots.pdf", height=5, width=10)


```




UVBIO analysis

T1 model
```{r}
library(gratia)
#####
uv.m1.gam=gam(abs.change.DOC ~ effect*Treatment +s(plant.mass..g, by=effect), data=degra.df, method="REML", select= T, subset= Time.point=="T1")
summary(uv.m1.gam)
anova(uv.m1.gam)
TukeyHSD(anova(uv.m1.gam))

library(multcomp)
glht(uv.m1.gam,linfct=mcp(effect="Tukey"))

draw(uv.m1.gam)
concrvity(uv.m1.gam)
gam.check(uv.m1.gam, rep=1000)
######
```
T4 model
```{r}
#####
uv.m3.gam=gam(abs.change.DOC ~ effect*Treatment +s(Start.DOC, by= effect) , data=degra.df, method="REML", select= T, subset= Time.point=="T3")
summary(uv.m3.gam)
draw(uv.m1.gam)
concrvity(uv.m1.gam)
gam.check(uv.m1.gam, rep=1000)
######
```





```{r}

library(visreg)
uv.t1.burned=visreg(uv.m1.gam, "Start.DOC", gg=TRUE, by="effect", overlay=T, partial=F, rug=F, cond=list(Treatment="burned")) +
  ggtitle("T1: Burned") +
  xlab("Initial DOC concentration (mg/L)")+
  theme_cowplot(12)

uv.t1.unburned=visreg(uv.m1.gam, "Start.DOC", gg=TRUE, by="effect", overlay=T, partial=F, rug=F, cond=list(Treatment="unburned")) +
  ggtitle("T1: Unburned") +
  xlab("Initial DOC concentration (mg/L)")+
  theme_cowplot(12)


#get legend
extract.legend.uv.t1 <- get_legend(
  # create some space to the left of the legend
  uv.t1.burned + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))


#combine them
uv.t1.plots=plot_grid(uv.t1.burned + theme(legend.position = "none", legend.title=element_blank()), uv.t1.unburned + theme(legend.position = "none"),
          extract.legend.uv.t1,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(15,15,3))


uv.t1.plots

```

T2 model
```{r}
uv.m2.gam=gam(abs.change.DOC ~ effect*Treatment + s(plant.mass..g, by= effect), data=degra.df, method="REML", select= T, subset= Time.point=="T2")
summary(uv.m2.gam)
gam.check(uv.m2.gam, rep=1000)
concrvity(uv.m2.gam)
draw(uv.m2.gam)


uv.m2b.gam=gam(mass.remaining.arc ~ effect*Treatment + s(plant.mass..g, by=effect, k=4, bs="ts") + s(plant.mass..g, by=Treatment, k=4, bs="cr"), data=degra.df, method="REML", select= T, subset= Time.point=="T2")
concurvity(uv.m2b.gam)
draw(uv.m2b.gam)
gam.check(uv.m2b.gam)
summary(uv.m2b.gam)


uv.m2c.gam=gam(mass.remaining.arc ~ effect*Treatment + s(plant.mass..g, by=effect, k=4, bs="ts") + s(plant.mass..g, by= Treatment, bs="ts"), data=degra.df, method="REML", select= T, subset= Time.point=="T2")
summary(uv.m2c.gam)
gam.check(uv.m2c.gam, rep=1000)
mgcv::concurvity(uv.m2c.gam, full=F)


#######
uv.m2d.gam=gam(mass.remaining.arc ~ effect*Treatment + s(plant.mass..g, bs="ps", k=4) +s(plant.mass..g, by=effect, k=4, bs="ts", m=1) + s(plant.mass..g, by= Treatment, bs="ts", m=1), data=degra.df, method="REML", select= T, subset= Time.point=="T2")
summary(uv.m2d.gam)
gam.check(uv.m2d.gam, rep=1000)
mgcv::concurvity(uv.m2d.gam, full=F)
######

uv.m2e.gam=gam(mass.remaining.arc ~ effect*Treatment + s(plant.mass..g, bs="ps", k=4) +s(plant.mass..g, by=effect, k=4, bs="ts", m=1) + s(plant.mass..g, by= Treatment, bs="ts", m=1), data=degra.df, method="REML", select= T, subset= Time.point=="T2")
summary(uv.m2e.gam)
gam.check(uv.m2e.gam, rep=1000)

AIC(uv.m2d.gam, uv.m2e.gam)
```
Visualize T2 uv.model2d
```{r}
uv.t2.burned=visreg(uv.m2.gam, "plant.mass..g", gg=TRUE, by="effect", overlay=T, partial=F, rug=F, cond=list(Treatment="burned")) +
  ggtitle("T2: Burned") +
  xlab("plant mass (g)")+
  theme_cowplot(12)

uv.t2.unburned=visreg(uv.m2.gam, "plant.mass..g", gg=TRUE, by="effect", overlay=T, partial=F, rug=F, cond=list(Treatment="unburned")) +
  ggtitle("T2: Unburned") +
  xlab("plant mass (g)")+
  theme_cowplot(12)


#combine them
uv.t2.plots=plot_grid(uv.t2.burned + theme(legend.position = "none", legend.title=element_blank()), uv.t2.unburned + theme(legend.position = "none"),
          extract.legend.uv.t1,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(15,15,3))


uv.t2.plots

```
T3 model
```{r}
uv.m3.gam=gam(abs.change.DOC ~ effect*Treatment + s(plant.mass..g, by=effect), data=degra.df, method="REML", select= T, subset= Time.point=="T3")
summary(uv.m3.gam)
concurvity(uv.m3.gam)

######
uv.m3b.gam=gam(mass.remaining.arc ~ effect*Treatment + s(plant.mass..g, by=effect, k=4, bs="cr") + s(plant.mass..g, by= Treatment, bs="ps"), data=degra.df, method="REML", select= T, subset= Time.point=="T3")
summary(uv.m3b.gam)
mgcv::concurvity(uv.m3b.gam, full=F)
gam.check(uv.m3b.gam, rep=1000)

#####

uv.m3c.gam=gam(mass.remaining.arc~ effect*Treatment + s(plant.mass..g, bs="cr", k=4) + s(plant.mass..g, by=effect, k=4, bs="cr", m=1) + s(plant.mass..g, by= Treatment, bs="ps",m=1), data=degra.df, method="REML", select= T, subset= Time.point=="T3")
summary(uv.m3c.gam)
mgcv::concurvity(uv.m3c.gam)
gam.check(uv.m3c.gam, rep=1000)


AIC(uv.m3.gam, uv.m3b.gam, uv.m3c.gam)

range(degra.df[degra.df$effect=="total",]$percent.change.DOC)


```
Visualize T3 uv.model3b
```{r}
uv.t3.burned=visreg(uv.m3.gam, "plant.mass..g", gg=TRUE, by="effect", overlay=T, partial=F, rug=F, cond=list(Treatment="burned")) +
  ggtitle("T3: Burned") +
  xlab("plant mass (g)")+
  theme_cowplot(12)

uv.t3.unburned=visreg(uv.m3.gam, "plant.mass..g", gg=TRUE, by="effect", overlay=T, partial=F, rug=F, cond=list(Treatment="unburned")) +
  ggtitle("T3: Unburned") +
  xlab("plant mass (g)")+
  theme_cowplot(12)


#combine them
uv.t3.plots=plot_grid(uv.t3.burned + theme(legend.position = "none", legend.title=element_blank()), uv.t3.unburned + theme(legend.position = "none"),
          extract.legend.uv.t1,
          labels = c("a)", "b)"),
          ncol=3, rel_widths = c(15,15,3))


uv.t3.plots



```






```{r}
gam.check(uv.m2.gam, rep=100)
plot(uv.m2.gam)
concrvity(uv.m2.gam)

class(degra.df$type)
#better to not order the factors
AIC(uv.m1.gam, uv.m2.gam)

#hereon data is arcsine transformed
uv.m3.gam=gam(mass.remaining.arc ~ type * Treatment + s(plant.mass..g, type, by=Treatment, bs="fs") + s(plant.mass..g, Time.point, bs="fs"), data=degra.df, family= gaussian(), method="REML", select= T)
summary(uv.m3.gam)
gam.check(uv.m3.gam, rep = 1000)
draw(uv.m3.gam)

AIC(uv.m1.gam, uv.m2.gam, uv.m3.gam)

uv.m4.gam=gam(log(mass.remaining.dec+1) ~ Treatment*type*Time.point + s(plant.mass..g, by=oTreatment) + s(plant.mass..g, by=oTime.point) + s(plant.mass..g, by= otype), data=degra.df, method="REML", select= T)
summary(uv.m4.gam)
gam.check(uv.m4.gam, rep = 1000)
draw(uv.m3.gam)

#knots are good
AIC(uv.m1.gam, uv.m2.gam, uv.m3.gam, uv.m4.gam)

uv.m5.gam=gam(mass.remaining.arc ~ Treatment*type*Time.point + s(plant.mass..g, k=3)+ s(plant.mass..g, by=oTreatment) + s(plant.mass..g, by= Time.point) + s(plant.mass..g, by= otype), data=degra.df, method="REML", select= T)
summary(uv.m5.gam) 
gam.check(uv.m5.gam, rep=1000)


AIC(uv.m1.gam, uv.m2.gam, uv.m3.gam, uv.m4.gam, uv.m5.gam)


uv.m6.gam=gam(mass.remaining.arc ~ Treatment*type*Time.point + s(plant.mass..g, k=3)+ s(plant.mass..g, by=oTreatment) + s(plant.mass..g, by= Time.point) + s(plant.mass..g, by= otype), data=degra.df, method="REML", select= T)
summary(uv.m6.gam)
gam.check(uv.m6.gam, rep = 1000)
draw(uv.m6.gam)

AIC(uv.m1.gam, uv.m2.gam, uv.m3.gam, uv.m4.gam, uv.m5.gam, uv.m6.gam)

uv.m7.gam=gam(mass.remaining.arc ~ Treatment*type*Time.point + s(plant.mass..g, by=oTreatment, m=1) + s(plant.mass..g, by=oTime.point, m=1) + s(plant.mass..g, by= otype, m=1), family= scat, data=degra.df, method="REML", select= T)
summary(uv.m7.gam)
gam.check(uv.m7.gam, rep = 1000)
draw(uv.m7.gam)

AIC(uv.m1.gam, uv.m2.gam, uv.m3.gam, uv.m4.gam, uv.m5.gam, uv.m6.gam, uv.m7.gam)


uv.m8.gam=gam(abs.change.DOC~ Treatment*type*Time.point + s(plant.mass..g) + s(plant.mass..g, by= oTreatment) +s(plant.mass..g, by= oTime.point) + s(plant.mass..g, by=otype), data=degra.df, method="REML")
summary(uv.m8.gam)
gam.check(uv.m8.gam, rep = 1000)

uv.m8.gam=uv.m7.gam=gam(abs.value.DOC~ Treatment + type + s(plant.mass..g, Treatment, by=type, bs="fs") + s(plant.mass..g, Time.point, by=Treatment, bs="fs"), family=tw(link = "log"), data=degra.df, method="REML")
summary(uv.m8.gam)

uv.m9.gam=gam(percent.change.DOC~ Treatment*type*Time.point + s(plant.mass..g, type, by=Treatment) + s(plant.mass..g, by=type) + s(plant.mass..g, by=Time.point), 
data=degra.df, select= T, method="REML")

summary(uv.m9.gam)

AIC(uv.m6.gam,uv.m7.gam, uv.m8.gam, uv.m9.gam)


class(degra.df$percent.change.DOC)











```

Sage and Willow Decomp data
```{r}
#load files and rearrange 
decomp.df=read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/decomp.weights.csv")
names(decomp.df)[8]= "change"
names(decomp.df)[9]= "percent.change"
decomp.df=decomp.df[-c(61:82), ] 



#make a duplicate dataframe and convert % to decimal
decomp2.df=data.frame(decomp.df)

#create a sage dataframe
sage.df=data.frame(decomp.df[decomp.df$plant.type=="sage",]$treatment,
                    decomp.df[decomp.df$plant.type=="sage",]$tank,
                    decomp.df[decomp.df$plant.type=="sage",]$plant.specific.mass..g,
                    decomp.df[decomp.df$plant.type=="sage",]$dry.mass..g.bag.corrected-decomp.df[decomp.df$plant.type=="sage",]$plant.specific.mass..g,
                     (100*(decomp.df[decomp.df$plant.type=="sage",]$dry.mass..g.bag.corrected-decomp.df[decomp.df$plant.type=="sage",]$plant.specific.mass..g)/(decomp.df[decomp.df$plant.type=="sage",]$plant.specific.mass..g)))
sage.df$type="sage"
names(sage.df)[1]="Treatment"
names(sage.df)[2]="Tank"
names(sage.df)[3]="plant.specific.mass..g"
names(sage.df)[4]="abs.change"
names(sage.df)[5]="percent.change"
sage.df[is.na(sage.df)] = 0
sage.df$mass.remaining=100-abs(sage.df[sage.df$type=="sage",]$percent.change)

#create a willow dataframe
willow.df=data.frame(decomp.df[decomp.df$plant.type=="willow",]$treatment,
                    decomp.df[decomp.df$plant.type=="willow",]$tank,
                    decomp.df[decomp.df$plant.type=="willow",]$plant.specific.mass..g,
                    decomp.df[decomp.df$plant.type=="willow",]$dry.mass..g.bag.corrected-decomp.df[decomp.df$plant.type=="willow",]$plant.specific.mass..g,
                     (100*(decomp.df[decomp.df$plant.type=="willow",]$dry.mass..g.bag.corrected-decomp.df[decomp.df$plant.type=="willow",]$plant.specific.mass..g)/(decomp.df[decomp.df$plant.type=="willow",]$plant.specific.mass..g)))
willow.df$type="willow"
names(willow.df)[1]="Treatment"
names(willow.df)[2]="Tank"
names(willow.df)[3]="plant.specific.mass..g"
names(willow.df)[4]="abs.change"
names(willow.df)[5]="percent.change"
willow.df[is.na(willow.df)] = 0
willow.df$mass.remaining=100-abs(willow.df[willow.df$type=="willow",]$percent.change)

#bind them
plant.df=rbind(sage.df, willow.df)

#remove mass remaining > 100 since those are the 'no biomass' tanks
plant.df=plant.df[!(plant.df$mass.remaining>=100),]

#transform for analysis
decomp2.df=decomp2.df%>% 
 mutate(
    across(c(9),
           .fns = ~asin(sqrt(.))))

```

Sage and Willow Decomp Plots (% mass remaining)
```{r}
Fig.formatting.decomp<-(theme_classic()) +
  theme(text=element_text(size=14),
        legend.text.align = 0,
        panel.border = element_rect(fill=NA, colour = "black", size=1),
        aspect.ratio=1, 
        axis.ticks.length=unit(0.25, "cm"),
        axis.text.y=element_text(
        margin=unit(c(0.5, 0.5, 0.5, 0.5), "cm"), colour="black", size=12), 
        axis.text.x=element_text(
        margin=unit(c(0.5, 0.5, 0.5, 0.5), "cm"), colour="black", size=12)) +
  theme(legend.key.size = unit(0.4, "cm")) +
  theme(aspect.ratio=1.3) +
  theme(panel.spacing=unit(c(0, 0, 0, 0), "cm"))


#sage treatment decomp
mass.sage.decomp.plot=ggplot(plant.df[(plant.df$type=="sage"),], aes(x=plant.specific.mass..g, y=mass.remaining, color=Treatment))+ 
  geom_point(alpha=0.4)+
   geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.3) +
  scale_color_manual(values = c("orange", "purple")) + 
  ggtitle("Sage") +
  ylab(expression(paste("Mass Remaining (%)"))) +
  xlab("Plant specific mass (g)")+
  Fig.formatting+
  theme(legend.position = "none")+
 
  coord_cartesian(ylim = c(20,100))

mass.sage.decomp.plot=mass.sage.decomp.plot+ labs(tag = "A")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")

  
#willow decomp
mass.willow.decomp.plot=ggplot(plant.df[(plant.df$type=="willow"),], aes(x=plant.specific.mass..g, y=mass.remaining, color=Treatment))+ 
   geom_point(alpha=0.4)+
   geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.3) +
  scale_color_manual(values = c("orange", "purple")) + 
  ggtitle("Willow") +
  ylab("Mass Remaining (%)") +
   xlab("Plant specific mass (g)")+
   coord_cartesian(ylim = c(20,100))+
  Fig.formatting

mass.willow.decomp.plot=mass.willow.decomp.plot + labs(tag = "B")+
  theme(plot.tag = element_text(face = "bold"),
        plot.tag.position = "topleft")



#combine them

mass.decomp.plots=plot_grid(
  mass.sage.decomp.plot, mass.willow.decomp.plot, ncol=2)



degra.plots
ggsave("figures/mass.plant_type_decomp.pdf", height=8, width=15)


```

Combined with box plots
```{r}
#Unburned treatment decomp
mass.sage.box.plot=ggplot(plant.df[(plant.df$type=="sage"),])+ 
  geom_boxplot(aes(x=Treatment,y=mass.remaining,fill=Treatment))+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Sage") +
  ylab(expression(paste("Mass Remaining (%)"))) +
  xlab("Treatment")+
  Fig.formatting+
  coord_cartesian(ylim = c(20,100))


#Burned decomp
mass.willow.box.plot=ggplot(plant.df[(plant.df$type=="willow"),])+ 
  geom_boxplot(aes(x=Treatment,y=mass.remaining,fill=Treatment))+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Willow") +
  ylab(expression(paste(""))) +
  xlab("Treatment")+
  Fig.formatting+
  coord_cartesian(ylim = c(20,100))
#box plots



extract.legend4 <- get_legend(
  # create some space to the left of the legend
  mass.unburned.decomp.plot + theme(legend.box.margin = margin(0, 0, 0, 10), legend.title=element_blank()))



mass.box.plots=plot_grid(
  mass.sage.box.plot + theme(legend.position = "none"),
  mass.willow.box.plot+ theme(legend.position = "none"),
  ncol=3, rel_widths = c(8,8,4))
mass.box.plots

#combine them
mass.combo.plots

mean(sage.df[sage.df$Treatment=="unburned",]$percent.change)
mean(willow.df[willow.df$Treatment=="unburned",]$percent.change)

ggarrange(
  mass.decomp.plots, mass.box.plots
  , nrow = 2, common.legend = T,
  labels = c("a)", "b)")
)


mass.combo.plots
ggsave("figures/decomp.combo.plots.pdf", height=8, width=9)


```

GAM for sage/willow
```{r}

plant.gam=gam(abs.change ~ Treatment*type + s(plant.specific.mass..g), data=plant.df, method= "REML", select=T)
summary(plant.gam)
anova(plant.gam)









```

SUVA 
SUVA calculations
Time point 0
```{r}
#load file and rearrange
suva.t0.df=read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/EEMs/Results_T0.csv")
suva.t0.df$Sample.Name=gsub("\\..*", "", suva.t0.df$Sample.Name) 
names(suva.t0.df)[1]="Tank"
suva.t0.df=suva.t0.df[-1,]
suva.t0.df$Tank=gsub("T", "", suva.t0.df$Tank) 
suva.t0.df$Tank=as.numeric(suva.t0.df$Tank)
suva.t0.df=suva.t0.df[order(suva.t0.df$Tank),]

#add important info
suva.t0.df$DOC..mg.L=DOC_T0$DOC..mg.L
suva.t0.df$Time.point="T0"
suva.t0.df$Treatment=IDs$Treatment
suva.t0.df$plant.mass..g=IDs$plant.mass..g

#calculate SUVA
suva.t0.df$SUVA=(suva.t0.df$abs254/suva.t0.df$DOC..mg.L)*100
```

Time point 1
```{r}
#load file and rearrange
library(dplyr)
suva.t1.df=read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/EEMs/Results_T1.csv")
suva.t1.df=suva.t1.df[-1,]
suva.t1.df=suva.t1.df[-1,]
names(suva.t1.df)[1]="Tank"
suva.t1.df$Tank=gsub("TA", "", suva.t1.df$Tank) 
suva.t1.df$Tank=sub("(.{2})(.*)", "\\1.\\2", suva.t1.df$Tank)
suva.t1.df$Tank=sub("\\..*", "", suva.t1.df$Tank)
suva.t1.df$Tank=as.numeric(suva.t1.df$Tank)
suva.t1.df=suva.t1.df[order(suva.t1.df$Tank),]

#add important info
suva.t1.df$DOC..mg.L=DOC_T1$DOC..mg.L
suva.t1.df$Time.point="T1"
suva.t1.df$Treatment=IDs$Treatment
suva.t1.df$plant.mass..g=IDs$plant.mass..g

#calculate SUVA
suva.t1.df$SUVA=(suva.t1.df[suva.t1.df$Tank,]$abs254/suva.t1.df[suva.t1.df$Tank,]$DOC..mg.L)*100
```

Time point 2
```{r}
#load file and rearrange
suva.t2.df=read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/EEMs/Results_T2_d1A.edit.csv")
names(suva.t2.df)[1]="Tank"
suva.t2.df$Tank=gsub("TA", "", suva.t2.df$Tank) 
suva.t2.df$Tank=sub("(.{2})(.*)", "\\1.\\2", suva.t2.df$Tank)
suva.t2.df$Tank=sub("\\..*", "", suva.t2.df$Tank)
suva.t2.df$Tank=as.numeric(suva.t2.df$Tank)
suva.t2.df=suva.t2.df[order(suva.t2.df$Tank),]

#add important info
suva.t2.df$DOC..mg.L=DOC_T2$DOC..mg.L
suva.t2.df$Time.point="T2"
suva.t2.df$Treatment=IDs$Treatment
suva.t2.df$plant.mass..g=IDs$plant.mass..g

#calculate SUVA
suva.t2.df$SUVA=(suva.t2.df[suva.t2.df$Tank,]$abs254/suva.t2.df[suva.t2.df$Tank,]$DOC..mg.L)*100

```

Time point 3
```{r}
suva.t3.df=read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/EEMs/Results_T3.csv")
names(suva.t3.df)[1]="Tank"
suva.t3.df$Tank=gsub("TA", "", suva.t3.df$Tank) 
suva.t3.df$Tank=sub("(.{2})(.*)", "\\1.\\2", suva.t3.df$Tank)
suva.t3.df$Tank=sub("\\..*", "", suva.t3.df$Tank)
suva.t3.df$Tank=as.numeric(suva.t3.df$Tank)
suva.t3.df=suva.t3.df[order(suva.t3.df$Tank),]


#add important info
suva.t3.df$DOC..mg.L=DOC_T3$DOC..mg.L
suva.t3.df$Time.point="T3"
suva.t3.df$Treatment=IDs$Treatment
suva.t3.df$plant.mass..g=IDs$plant.mass..g
class(suva.t3.df$DOC..mg.L)

#calculate SUVA
suva.t3.df$SUVA=(suva.t3.df[suva.t3.df$Tank,]$abs254/suva.t3.df[suva.t3.df$Tank,]$DOC..mg.L)*100

```

Time point 4
```{r}
suva.t4.df=read.csv("/Users/tobyspiegel2/Desktop/GitHub/Pyromania/data/EEMs/Results_T4.csv")
names(suva.t4.df)[1]="Tank"
suva.t4.df$Tank=gsub("TA", "", suva.t4.df$Tank) 
suva.t4.df$Tank=sub("(.{2})(.*)", "\\1.\\2", suva.t4.df$Tank)
suva.t4.df$Tank=sub("\\..*", "", suva.t4.df$Tank)
suva.t4.df$Tank=as.numeric(suva.t4.df$Tank)
suva.t4.df=suva.t4.df[order(suva.t4.df$Tank),]

#add important info
suva.t4.df$DOC..mg.L=DOC_T4$DOC..mg.L
suva.t4.df$Time.point="T4"
suva.t4.df$Treatment=IDs$Treatment
suva.t4.df$plant.mass..g=IDs$plant.mass..g

#calculate SUVA
suva.t4.df$SUVA=(suva.t4.df[suva.t4.df$Tank,]$abs254/suva.t4.df[suva.t4.df$Tank,]$DOC..mg.L)*100

```

Combine all SUVA time points
```{r}
suva.df=rbind(suva.t0.df, suva.t1.df, suva.t2.df, suva.t3.df, suva.t4.df)

library(dplyr)

#5, 125, 225g subsets

suva.subset.df=suva.df %>% 
  filter((plant.mass..g == "5" | plant.mass..g == "125" | plant.mass..g == "225"))

suva.subset.df$Level=as.factor(ifelse(suva.subset.df$plant.mass..g=="5", "Low",
         ifelse (suva.subset.df$plant.mass..g=="125", "Medium",
           ifelse (suva.subset.df$plant.mass..g=="225", "High", "High"))))


suva.subset.df$Levels  <- reorder.factor(suva.subset.df$Levels , levels = c("Low","Medium", "High"))

```


SUVA plots
```{r}
suva.T0<-ggplot(suva.subset.df[(suva.subset.df$Time.point=="T0"),], aes(x=Level, y=SUVA, fill=Treatment)) +
  geom_bar(stat = "identity", position = "dodge")+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-0") +
  xlab("")+
  ylab(bquote(SUVA~(Lmg^-1~m^-1)))+
  Fig.formatting

suva.T0

suva.T1<-ggplot(suva.df[(suva.df$Time.point=="T1"),], aes(x=plant.mass..g, y=SUVA, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
 geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
  Fig.formatting
  
  
suva.T2<-ggplot(suva.df[(suva.df$Time.point=="T2"),], aes(x=plant.mass..g, y=SUVA, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-2") +
  xlab("Plant mass (g)") +
  ylab("")+
  Fig.formatting



  
suva.T3<-ggplot(suva.df[(suva.df$Time.point=="T3"),], aes(x=plant.mass..g, y=SUVA, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

suva.T4<-ggplot(suva.df[(suva.df$Time.point=="T4"),], aes(x=plant.mass..g, y=SUVA, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
 geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting


extract.legend5 <- get_legend(
  # create some space to the left of the legend
  suva.T0 + theme(legend.box.margin = margin(0, 0, 0, 10)))


suva.plots<-plot_grid(
  suva.T0+ theme(legend.position = "none"),
  suva.T1+ theme(legend.position = "none"),
  suva.T2+ theme(legend.position = "none"),
  suva.T3+ theme(legend.position = "none"),
  suva.T4+ theme(legend.position = "none"),
  extract.legend5,
  rel_widths = c(50,50,50,50, 50, 20), ncol=6)

suva.plots

ggsave("figures/suva.pdf", height=5, width=14)

class(suva.subset.df$Level)

```

SUVA box plots
```{r}
suva.T0.box<-ggplot(suva.df[(suva.df$Time.point=="T0"),], aes(x=Treatment, y=SUVA, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-0") +
  xlab("")+
  ylab(bquote(SUVA~(Lmg^-1~m^-1)))+
  Fig.formatting


suva.T1.box<-ggplot(suva.df[(suva.df$Time.point=="T1"),], aes(x=Treatment, y=SUVA, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
  Fig.formatting

suva.T2.box<-ggplot(suva.df[(suva.df$Time.point=="T2"),], aes(x=Treatment, y=SUVA, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-2") +
  xlab("Treatment")+
  ylab("")+
  Fig.formatting

suva.T3.box<-ggplot(suva.df[(suva.df$Time.point=="T3"),], aes(x=Treatment, y=SUVA, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
  Fig.formatting

suva.T4.box<-ggplot(suva.df[(suva.df$Time.point=="T4"),], aes(x=Treatment, y=SUVA, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
  Fig.formatting

suva.box.plots=plot_grid(
  suva.T0.box+ theme(legend.position = "none"),
  suva.T1.box+ theme(legend.position = "none"),
  suva.T2.box+ theme(legend.position = "none"),
  suva.T3.box+ theme(legend.position = "none"),
  suva.T4.box+ theme(legend.position = "none"),
  rel_widths = c(50,50,50,50, 50, 20), ncol=6
  
)


suva.combo.plots=ggarrange(suva.plots, suva.box.plots, nrow=2, labels= c("a)", "b)", "c)"), legend = "right",common.legend = T)

ggsave("figures/suva.combo.plots.pdf", height=10, width=14)



```




SUVA GAM
Time point 1
```{r}

suva.gam1=gam(SUVA ~ factor(Treatment) +s(plant.mass..g, by=factor(Treatment)), data = suva.df, method="REML", select= T, subset = Time.point=="T1")
anova(suva.gam1)
summary(suva.gam1)
gam.check(suva.gam1, rep=1000)


```
Time point 2

```{r}

suva.gam2=gam(SUVA ~ factor(Treatment) +s(plant.mass..g, by=factor(Treatment)), data = suva.df, method="REML", select= T, subset = Time.point=="T2")
summary(suva.gam2)
anova(suva.gam2)
gam.check(suva.gam2, rep=1000)

```
Time point 3
```{r}
suva.gam3=gam(SUVA ~ Treatment +s(plant.mass..g, by=factor(Treatment)), data = suva.df, method="REML", select= T, subset = Time.point=="T3")
summary(suva.gam3)
anova(suva.gam3)
gam.check(suva.gam3, rep=1000)



```
Time point 4
```{r}

suva.gam4=gam(SUVA ~ factor(Treatment) +s(plant.mass..g, by=factor(Treatment)), data = suva.df, method="REML", select= T, subset = Time.point=="T4")
anova(suva.gam4)
summary(suva.gam4)
gam.check(suva.gam4, rep=1000)




```

Other indices
```{r}
# Time 0
index.T0.df=read.csv("/Users/tobyspiegel2/Desktop/My_pyromania/EEMS/Indexresults/T0_indices.csv")
index.T0.df$Time.point="T0"
names(index.T0.df)[6]="Humification.Index"
index.T0.df=index.T0.df[-c(7:11,13,14)]


#Time 1
index.T1.df=read.csv("/Users/tobyspiegel2/Desktop/My_pyromania/EEMS/Indexresults/T1_indices.csv")
index.T1.df$Time.point="T1"
index.T1.df=index.T1.df[-c(7:11,13,14)]

#Time 3
index.T3.df=read.csv("/Users/tobyspiegel2/Desktop/My_pyromania/EEMS/Indexresults/T3_indices.csv")
index.T3.df$Time.point="T3"
index.T3.df=index.T3.df[-c(7:11,13,14)]


#Time 4
index.T4.df=read.csv("/Users/tobyspiegel2/Desktop/My_pyromania/EEMS/Indexresults/T4_indicies.csv")
index.T4.df$Time.point="T4"
index.T4.df=index.T4.df[-c(7:11,13,14)]

#combine all index time points
index.df=rbind(index.T0.df, index.T1.df, index.T3.df, index.T4.df)


```


freshness plots
```{r}
fresh.T0<-ggplot(index.df[(index.df$Time.point=="T0"),], aes(x=plant.mass..g., y=Freshness.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-0") +
  xlab("")+
  ylab("Freshness Index")+
Fig.formatting



fresh.T1<-ggplot(index.df[(index.df$Time.point=="T1"),], aes(x=plant.mass..g., y=Freshness.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
Fig.formatting


fresh.T3<-ggplot(index.df[(index.df$Time.point=="T3"),], aes(x=plant.mass..g., y=Freshness.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

fresh.T4<-ggplot(index.df[(index.df$Time.point=="T4"),], aes(x=plant.mass..g., y=Freshness.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting

extract.legend5 <- get_legend(
  # create some space to the left of the legend
  suva.T0 + theme(legend.box.margin = margin(0, 0, 0, 10)))


fresh.plots<-plot_grid(
  fresh.T0+ theme(legend.position = "none"),
  fresh.T1+ theme(legend.position = "none"),
  fresh.T3+ theme(legend.position = "none"),
  fresh.T4+ theme(legend.position = "none"),
  extract.legend5,
  rel_widths = c(50,50,50,50, 20), ncol=5)

fresh.plots

```

freshness box plots
```{r}
fresh.T0.box<-ggplot(index.df[(index.df$Time.point=="T0"),], aes(x=Treatment, y=Freshness.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-0") +
  xlab("")+
  ylab("Freshness Index")+
Fig.formatting

fresh.T1.box<-ggplot(index.df[(index.df$Time.point=="T1"),], aes(x=Treatment, y=Freshness.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
Fig.formatting

fresh.T3.box<-ggplot(index.df[(index.df$Time.point=="T3"),], aes(x=Treatment, y=Freshness.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

fresh.T4.box<-ggplot(index.df[(index.df$Time.point=="T4"),], aes(x=Treatment, y=Freshness.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting

fresh.box.plots=plot_grid(
  fresh.T0.box + theme(legend.position = "none"),
  fresh.T1.box + theme(legend.position = "none"),
  fresh.T3.box + theme(legend.position = "none"),
  fresh.T4.box + theme(legend.position = "none"),
  ncol=5, rel_widths = c(50,50,50,50, 20)
)


fresh.combo.plots=ggarrange(fresh.plots, fresh.box.plots, nrow=2, common.legend = T, legend = "right")


ggsave("figures/freshness.combo.plots.pdf", height=10, width=14)






```

fluorescence plots
```{r}
fluoro.T0<-ggplot(index.df[(index.df$Time.point=="T0"),], aes(x=plant.mass..g., y=Fluroscence.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-0") +
  xlab("")+
  ylab("Fluorescence Index")+
Fig.formatting



fluoro.T1<-ggplot(index.df[(index.df$Time.point=="T1"),], aes(x=plant.mass..g., y=Fluroscence.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
Fig.formatting


fluoro.T3<-ggplot(index.df[(index.df$Time.point=="T3"),], aes(x=plant.mass..g., y=Fluroscence.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

fluoro.T4<-ggplot(index.df[(index.df$Time.point=="T4"),], aes(x=plant.mass..g., y=Fluroscence.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting


extract.legend5 <- get_legend(
  # create some space to the left of the legend
  suva.T0 + theme(legend.box.margin = margin(0, 0, 0, 10)))


fluoro.plots<-plot_grid(
  fluoro.T0+ theme(legend.position = "none"),
  fluoro.T1+ theme(legend.position = "none"),
  fluoro.T3+ theme(legend.position = "none"),
  fluoro.T4+ theme(legend.position = "none"),
  extract.legend5,
  rel_widths = c(50,50,50,50, 20), ncol=5)


```

fluorescence box plots
```{r}
fluoro.T0.box<-ggplot(index.df[(index.df$Time.point=="T0"),], aes(x=Treatment, y=Fluroscence.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-0") +
  xlab("")+
  ylab("Fluorescence Index")+
Fig.formatting

fluoro.T1.box<-ggplot(index.df[(index.df$Time.point=="T1"),], aes(x=Treatment, y=Fluroscence.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
Fig.formatting

fluoro.T3.box<-ggplot(index.df[(index.df$Time.point=="T3"),], aes(x=Treatment, y=Fluroscence.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

fluoro.T4.box<-ggplot(index.df[(index.df$Time.point=="T4"),], aes(x=Treatment, y=Fluroscence.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting

fluoro.box.plots=plot_grid(
  fluoro.T0.box + theme(legend.position = "none"),
  fluoro.T1.box + theme(legend.position = "none"),
  fluoro.T3.box + theme(legend.position = "none"),
  fluoro.T4.box + theme(legend.position = "none"),
  ncol=5, rel_widths = c(50,50,50,50, 20)
)


fluoro.combo.plots=ggarrange(fluoro.plots, fluoro.box.plots, nrow=2, common.legend = T, legend = "right")




ggsave("figures/fluoro.combo.plots.pdf", height=10, width=14)


```


humic plots
```{r}
humic.T0<-ggplot(index.df[(index.df$Time.point=="T0"),], aes(x=plant.mass..g., y=Humification.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-0") +
  xlab("")+
  ylab("Humification Index")+
Fig.formatting



humic.T1<-ggplot(index.df[(index.df$Time.point=="T1"),], aes(x=plant.mass..g., y=Humification.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
Fig.formatting


humic.T3<-ggplot(index.df[(index.df$Time.point=="T3"),], aes(x=plant.mass..g., y=Humification.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

humic.T4<-ggplot(index.df[(index.df$Time.point=="T4"),], aes(x=plant.mass..g., y=Humification.Index, color=Treatment)) +
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("orange", "purple")) + 
  geom_smooth(method=gam, formula= y~s(x), aes(fill=Treatment), alpha=0.1) +
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting


extract.legend5 <- get_legend(
  # create some space to the left of the legend
  suva.T0 + theme(legend.box.margin = margin(0, 0, 0, 10)))


humic.plots<-plot_grid(
  humic.T0+ theme(legend.position = "none"),
  humic.T1+ theme(legend.position = "none"),
  humic.T3+ theme(legend.position = "none"),
  humic.T4+ theme(legend.position = "none"),
  extract.legend5,
  rel_widths = c(50,50,50,50, 20), ncol=5)


```

humic box plots
```{r}
humic.T0.box<-ggplot(index.df[(index.df$Time.point=="T0"),], aes(x=Treatment, y=Humification.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-0") +
  xlab("")+
  ylab("Humification Index")+
Fig.formatting

humic.T1.box<-ggplot(index.df[(index.df$Time.point=="T1"),], aes(x=Treatment, y=Humification.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-1") +
  xlab("")+
  ylab("")+
Fig.formatting

humic.T3.box<-ggplot(index.df[(index.df$Time.point=="T3"),], aes(x=Treatment, y=Humification.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-3") +
  xlab("")+
  ylab("")+
Fig.formatting

humic.T4.box<-ggplot(index.df[(index.df$Time.point=="T4"),], aes(x=Treatment, y=Humification.Index, fill=Treatment)) +
  geom_boxplot()+
  scale_fill_manual(values = c("orange", "purple")) + 
  ggtitle("Time-4") +
  xlab("")+
  ylab("")+
Fig.formatting

humic.box.plots=plot_grid(
  humic.T0.box + theme(legend.position = "none"),
  humic.T1.box + theme(legend.position = "none"),
  humic.T3.box + theme(legend.position = "none"),
  humic.T4.box + theme(legend.position = "none"),
  ncol=5, rel_widths = c(50,50,50,50, 20)
)


humic.combo.plots=ggarrange(humic.plots, humic.box.plots, nrow=2, common.legend = T, legend = "right")


ggsave("figures/humic.combo.plots.pdf", height=10, width=14)


```

All indices

```{r}


index.combo.plots=ggarrange(fresh.combo.plots, fluoro.combo.plots, humic.combo.plots, labels = c("a)", "b)", "c)"),ncol=3, common.legend = T, legend = "right")



ggsave("figures/index.combo.plots.pdf", height=20, width=45)








```

