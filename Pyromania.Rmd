---
title: "Pyromania"
author: "C Wall"
date: "1/4/2021"
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 4
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '4'
---

```{r setup chunk, setup, include = FALSE, cache=FALSE, message=FALSE, warning=FALSE}
if (!require('knitr')) install.packages('knitr'); library('knitr')
knitr::opts_chunk$set(warning=FALSE, message=FALSE, fig.align='center')

# load packages
if (!require("pacman")) install.packages("pacman") # for rapid install if not in library

# use pacman to load all the packages you are missing!
pacman::p_load('knitr', 'lme4', 'lmerTest', 'tidyverse', 'magrittr', 'effects', 'plyr', 'dplyr', 
               'plotrix', 'car',"gridExtra", "cowplot", "tools")


```


###YSI  
Time 1 and Time 2: import YSI data and produce plots of changes in O2% and net ecosystem productivity (NEP) and net ecosystem respiration (NER)  
```{r}
#load YSI data
YSI<-read.csv("data/Pyro_YSI.csv")

# fix date
YSI$Date<-as.character(YSI$Date)
YSI$Date<-as.POSIXct(YSI$Date, format="%m/%d/%Y")
YSI$Date<-as.Date(YSI$Date, format="%m/%d/%Y")


####### Time 1 change in O2 ################

#separate time points
YSI.T1<- YSI[(YSI$Time.point=="T1"),]

#calculate NEP for T1
T1.Prod<-YSI.T1[(YSI.T1$Date == "2021-11-15"),] # dawn and dusk for 12h period
T1.Dawn1<-T1.Prod[(T1.Prod$Dawn..Dusk == "dawn"),] # dawn-1 measurements
T1.Dusk<-T1.Prod[(T1.Prod$Dawn..Dusk == "dusk"),] # dusk measurements

T1.Dawn2<-YSI.T1[(YSI.T1$Date == "2021-11-16"),] # dawn-2 measurements, following AM

# make new dataframe
T1.O2<-(T1.Dawn1[,c(2,4:6)]) 
T1.O2$dawn1<-T1.Dawn1$DO.percent
T1.O2$dusk1<-T1.Dusk$DO.percent
T1.O2$dawn2<-T1.Dawn2$DO.percent

# NER = dusk - dawn (PM to AM, O2 change of day 1)
# NEP = dusk - dawn (PM to AM, O2 change of day 2)

T1.O2<- mutate(T1.O2, 
                NEP=dusk1 - dawn1,
                NER=dawn2 - dusk1) 

#sort
T1.O2<-T1.O2 %>% 
  arrange(Treatment, plant.mass..g) 


################ ################ ################
####### Time 2 change in O2 ################

#separate time points
YSI.T2<- YSI[(YSI$Time.point=="T2"),]

#calculate NEP for T2
T2.Prod<-YSI.T2[(YSI.T2$Date == "2021-12-06"),] # dawn and dusk for 12h period
T2.Dawn1<-T2.Prod[(T2.Prod$Dawn..Dusk == "dawn"),] # dawn-1 measurements
T2.Dusk<-T2.Prod[(T2.Prod$Dawn..Dusk == "dusk"),] # dusk measurements

T2.Dawn2<-YSI.T2[(YSI.T2$Date == "2021-12-07"),] # dawn-2 measurements, following AM

# make new dataframe
T2.O2<-(T2.Dawn1[,c(2,4:6)]) 
T2.O2$dawn1<-T2.Dawn1$DO.percent
T2.O2$dusk1<-T2.Dusk$DO.percent
T2.O2$dawn2<-T2.Dawn2$DO.percent

T2.O2<- mutate(T2.O2, 
                NEP=dusk1 - dawn1,
                NER=dawn2 - dusk1) 

#sort
T2.O2<-T2.O2 %>% 
  arrange(Treatment, plant.mass..g) 


################ ################ ################
####### Time 3 change in O2 ################

#separate time points
YSI.T3<- YSI[(YSI$Time.point=="T3"),]

#calculate NEP for T3
T3.Prod<-YSI.T3[(YSI.T3$Date == "2022-01-03"),] # dawn and dusk for 12h period
T3.Dawn1<-T3.Prod[(T3.Prod$Dawn..Dusk == "dawn"),] # dawn-1 measurements
T3.Dusk<-T3.Prod[(T3.Prod$Dawn..Dusk == "dusk"),] # dusk measurements

T3.Dawn2<-YSI.T3[(YSI.T3$Date == "2022-01-04"),] # dawn-2 measurements, following AM

# make new dataframe
T3.O2<-(T3.Dawn1[,c(2,4:6)]) 
T3.O2$dawn1<-T3.Dawn1$DO.percent
T3.O2$dusk1<-T3.Dusk$DO.percent
T3.O2$dawn2<-T3.Dawn2$DO.percent

T3.O2<- mutate(T3.O2, 
                NEP=dusk1 - dawn1,
                NER=dawn2 - dusk1) 

#sort
T3.O2<-T3.O2 %>% 
  arrange(Treatment, plant.mass..g) 

################ ################ ################
####### Time 3 change in O2 ################

#separate time points
YSI.T4<- YSI[(YSI$Time.point=="T4"),]

#calculate NEP for T4
T4.Prod<-YSI.T4[(YSI.T4$Date == "2022-02-02"),] # dawn and dusk for 12h period
T4.Dawn1<-T4.Prod[(T4.Prod$Dawn..Dusk == "dawn"),] # dawn-1 measurements
T4.Dusk<-T4.Prod[(T4.Prod$Dawn..Dusk == "dusk"),] # dusk measurements

T4.Dawn2<-YSI.T4[(YSI.T4$Date == "2022-02-03"),] # dawn-2 measurements, following AM

# make new dataframe
T4.O2<-(T4.Dawn1[,c(2,4:6)]) 
T4.O2$dawn1<-T4.Dawn1$DO.percent
T4.O2$dusk1<-T4.Dusk$DO.percent
T4.O2$dawn2<-T4.Dawn2$DO.percent

T4.O2<- mutate(T4.O2, 
                NEP=dusk1 - dawn1,
                NER=dawn2 - dusk1) 

#sort
T4.O2<-T4.O2 %>% 
  arrange(Treatment, plant.mass..g) 

################ ################ ################
# combine T1  T2  T3 T4 timepoints
################ ################ ################
O2.tanks<-rbind(T1.O2,T2.O2, T3.O2, T4.O2)
```
  
TIME POINT 1: Change in O2% and NEP and NER --   
make figures of the data for timepoint 1  
```{r}
########## 
Fig.formatting<-(theme_classic()) +
  theme(text=element_text(size=10),
        axis.line=element_blank(),
        legend.text.align = 0,
        legend.text=element_text(size=10),
        #legend.title = element_blank(),
        panel.border = element_rect(fill=NA, colour = "black", size=1),
        aspect.ratio=1, 
        axis.ticks.length=unit(0.25, "cm"),
        axis.text.y=element_text(
          margin=unit(c(0.5, 0.5, 0.5, 0.5), "cm"), colour="black", size=10), 
        axis.text.x=element_text(
          margin=unit(c(0.5, 0.5, 0.5, 0.5), "cm"), colour="black", size=8)) +
  theme(legend.key.size = unit(0.4, "cm")) +
  theme(aspect.ratio=1.3) +
  theme(panel.spacing=unit(c(0, 0, 0, 0), "cm"))

#########################################################
############################################################################
###############################################################################################
###################

# total oxygen % plot for the 3 time points (dawn-dusk-dawn)

T1.AM1<-ggplot(T1.O2, aes(x=plant.mass..g, y=dawn1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T1.dawn1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T1.PM1<-ggplot(T1.O2, aes(x=plant.mass..g, y=dusk1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T1.dusk1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T1.AM2<-ggplot(T1.O2, aes(x=plant.mass..g, y=dawn2, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T1.dawn2")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

extract.legend <- get_legend(
  # create some space to the left of the legend
  T1.AM1 + theme(legend.box.margin = margin(0, 0, 0, 10)))

O2.T1<-plot_grid(
  T1.AM1+ theme(legend.position = "none"), 
  T1.PM1+ theme(legend.position = "none"), 
  T1.AM2+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,3), ncol=4)

ggsave("figures/O2.T1.pdf", height=5, width=9)

#################################
############################################
# net ecosystem production and respiration

#Time 1 NEP
NEP.T1<-ggplot(T1.O2, aes(x=plant.mass..g, y=NEP, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ylab(expression(paste("Net Production (", Delta, "O"[2],"%)"))) +
  coord_cartesian(ylim=c(-20, 50)) +
  xlab("plant material (g)")+
  Fig.formatting

#Time 1 NER
NER.T1<-ggplot(T1.O2, aes(x=plant.mass..g, y=NER, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-40, 10)) +
  ylab(expression(paste("Net Respiration (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting


O2.change.T1<-plot_grid(
  NEP.T1+ theme(legend.position = "none") + ggtitle("Time 1"), 
  NER.T1+ theme(legend.position = "none") + ggtitle(""),
  extract.legend, 
  rel_widths = c(8,8,3), ncol=3)

ggsave("figures/O2.change.T1.pdf", height=5, width=8)
```
  
TIME POINT 2: Change in O2% and NEP and NER --
make figures of the data for timepoint 2
```{r}
############################################################
##############################################################################
#############################################################################################
###################

# total oxygen % plot for the 3 time points (dawn-dusk-dawn)

T2.AM1<-ggplot(T2.O2, aes(x=plant.mass..g, y=dawn1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T2.dawn1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T2.PM1<-ggplot(T2.O2, aes(x=plant.mass..g, y=dusk1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T2.dusk1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T2.AM2<-ggplot(T2.O2, aes(x=plant.mass..g, y=dawn2, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T2.dawn2")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

O2.T2<-plot_grid(
  T2.AM1+ theme(legend.position = "none"), 
  T2.PM1+ theme(legend.position = "none"),
  T2.AM2+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,3), ncol=4)

ggsave("figures/O2.T2.pdf", height=5, width=9)


############################################################
##############################################################################################
# net ecosystem production and respiration

#Time 2 NEP
NEP.T2<-ggplot(T2.O2, aes(x=plant.mass..g, y=NEP, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-20, 50)) +
  ylab(expression(paste("Net Production (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting

#Time 2 NER
NER.T2<-ggplot(T2.O2, aes(x=plant.mass..g, y=NER, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment),alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-40, 10)) +
  ylab(expression(paste("Net Respiration (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting

O2.change.T2<-plot_grid(
  NEP.T2+ theme(legend.position = "none") + ggtitle("Time 2"),
  NER.T2+ theme(legend.position = "none") + ggtitle(""),
  extract.legend, 
  rel_widths = c(8,8,3), ncol=3)

ggsave("figures/O2.change.T2.pdf", height=5, width=8)


```

TIME POINT 3: Change in O2% and NEP and NER --
make figures of the data for timepoint 3
```{r}
############################################################
##############################################################################
#############################################################################################
###################

# total oxygen % plot for the 3 time points (dawn-dusk-dawn)

T3.AM1<-ggplot(T3.O2, aes(x=plant.mass..g, y=dawn1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T3.dawn1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T3.PM1<-ggplot(T3.O2, aes(x=plant.mass..g, y=dusk1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T3.dusk1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T3.AM2<-ggplot(T3.O2, aes(x=plant.mass..g, y=dawn2, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T3.dawn2")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

O2.T3<-plot_grid(
  T3.AM1+ theme(legend.position = "none"), 
  T3.PM1+ theme(legend.position = "none"),
  T3.AM2+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,3), ncol=4)

ggsave("figures/O2.T3.pdf", height=5, width=9)


############################################################
##############################################################################################
# net ecosystem production and respiration

#Time 3 NEP
NEP.T3<-ggplot(T3.O2, aes(x=plant.mass..g, y=NEP, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-20, 50)) +
  ylab(expression(paste("Net Production (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting

#Time 3 NER
NER.T3<-ggplot(T3.O2, aes(x=plant.mass..g, y=NER, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment),alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-40, 10)) +
  ylab(expression(paste("Net Respiration (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting

O2.change.T3<-plot_grid(
  NEP.T3+ theme(legend.position = "none") + ggtitle("Time 3"),
  NER.T3+ theme(legend.position = "none") + ggtitle(""),
  extract.legend, 
  rel_widths = c(8,8,3), ncol=3)

ggsave("figures/O2.change.T3.pdf", height=5, width=8)


```
  
TIME POINT 4: Change in O2% and NEP and NER --
make figures of the data for timepoint 4
```{r}
############################################################
##############################################################################
#############################################################################################
###################

# total oxygen % plot for the 3 time points (dawn-dusk-dawn)

T4.AM1<-ggplot(T4.O2, aes(x=plant.mass..g, y=dawn1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T4.dawn1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T4.PM1<-ggplot(T4.O2, aes(x=plant.mass..g, y=dusk1, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T4.dusk1")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

T4.AM2<-ggplot(T4.O2, aes(x=plant.mass..g, y=dawn2, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  ggtitle("T4.dawn2")+
  coord_cartesian(ylim=c(-30, 150)) +
  ylab(expression(paste("O"[2],"%"))) +
  xlab("plant material (g)") +
  Fig.formatting

O2.T4<-plot_grid(
  T4.AM1+ theme(legend.position = "none"), 
  T4.PM1+ theme(legend.position = "none"),
  T4.AM2+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,3), ncol=4)

ggsave("figures/O2.T4.pdf", height=5, width=9)


############################################################
##############################################################################################
# net ecosystem production and respiration

#Time 4 NEP
NEP.T4<-ggplot(T4.O2, aes(x=plant.mass..g, y=NEP, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-20, 50)) +
  ylab(expression(paste("Net Production (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting

#Time 4 NER
NER.T4<-ggplot(T4.O2, aes(x=plant.mass..g, y=NER, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment),alpha=0.1) +
  geom_hline(yintercept=0, linetype="longdash", color = "gray") +
  coord_cartesian(ylim=c(-40, 10)) +
  ylab(expression(paste("Net Respiration (", Delta, "O"[2],"%)"))) +
  xlab("plant material (g)") +
  Fig.formatting

O2.change.T4<-plot_grid(
  NEP.T4+ theme(legend.position = "none") + ggtitle("Time 4"),
  NER.T4+ theme(legend.position = "none") + ggtitle(""),
  extract.legend, 
  rel_widths = c(8,8,3), ncol=3)

ggsave("figures/O2.change.T4.pdf", height=5, width=8)

########## ########## ########## ########## ########## 
########## compile all figs

##### All dawn-dusk-dawn measurements
O2change.alltimes<-plot_grid(
  O2.T1,
  O2.T2,
  O2.T3,
  O2.T4, ncol=1)

ggsave("figures/O2change.alltimes.pdf", height=12, width=10)


##### All photosynthesis and respiration

PnR.alltimes<-plot_grid(
  O2.change.T1,
  O2.change.T2,
  O2.change.T3,
  O2.change.T4, ncol=1)

ggsave("figures/PnR.alltimes.pdf", height=12, width=8)


```
  
  
###Chlorophyll  
import 
```{r}
## import treatment IDs
chl.dat<- read.csv("data/Pyro_chlorophyll.csv")  
chl.dat<-chl.dat[!(chl.dat$Time.point=="First.round"),] # remove first round from aborted mission


#plot

chla.T0<-ggplot(chl.dat[(chl.dat$Time.point=="T0"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 20)) +
  ggtitle("Time-0") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting


chla.T1<-ggplot(chl.dat[(chl.dat$Time.point=="T1"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 20)) +
  ggtitle("Time-1") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting

chla.T2<-ggplot(chl.dat[(chl.dat$Time.point=="T2"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 20)) +
  ggtitle("Time-2") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting

chla.T3<-ggplot(chl.dat[(chl.dat$Time.point=="T3"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 20)) +
  ggtitle("Time-3") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting

chla.T4<-ggplot(chl.dat[(chl.dat$Time.point=="T4"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 20)) +
  ggtitle("Time-4") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting


chl.plots<-plot_grid(
  chla.T0+ theme(legend.position = "none"),
  chla.T1+ theme(legend.position = "none"),
  chla.T2+ theme(legend.position = "none"),
  chla.T3+ theme(legend.position = "none"),
  chla.T4+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,8,3), ncol=6)


chl.plots

ggsave("figures/chla.plots.pdf", height=5, width=12)




#remove outlier
chl.out.rem<-chl.dat[!(chl.dat$chla..ug.L>=10),]


chla.T0<-ggplot(chl.out.rem[(chl.out.rem$Time.point=="T0"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 12)) +
  ggtitle("Time-0") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting


chla.T1<-ggplot(chl.out.rem[(chl.out.rem$Time.point=="T1"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 12)) +
  ggtitle("Time-1") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting

chla.T2<-ggplot(chl.out.rem[(chl.out.rem$Time.point=="T2"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 12)) +
  ggtitle("Time-2") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting

chla.T3<-ggplot(chl.out.rem[(chl.out.rem$Time.point=="T3"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 12)) +
  ggtitle("Time-3") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting

chla.T4<-ggplot(chl.out.rem[(chl.out.rem$Time.point=="T4"),], aes(x=plant.mass..g, y=chla..ug.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 12)) +
  ggtitle("Time-4") +
  ylab("chlorophyll (ug/L)") +
  xlab("plant material (g)") +
  Fig.formatting


chl.plots<-plot_grid(
  chla.T0+ theme(legend.position = "none"),
  chla.T1+ theme(legend.position = "none"),
  chla.T2+ theme(legend.position = "none"),
  chla.T3+ theme(legend.position = "none"),
  chla.T4+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,8,3), ncol=6)


chl.plots

ggsave("figures/chla.plots2.pdf", height=5, width=12)



```
  
  
###DOC  
import and do a loop to clean up all files and make stacked data in single df
```{r}
## import treatment IDs
IDs<-read.csv("data/treatment.IDs.csv")

##### grab files in a list
Total.DOC.files <- list.files(path="data/DOC.TN", pattern = "csv$", full.names = T)
Total.DOC.files

##### what are the file names, sans extensions using package 'tools'
file.names<-file_path_sans_ext(list.files(path="data/DOC.TN", pattern = "csv$", full.names = F))
file.names
############ formatting all data in for loop
  for(i in 1:length(Total.DOC.files))
    {
  data<-read.csv(Total.DOC.files[i], sep=",")
  data<-data[,c(1,3,4)] # removed columns we don't need
  data$File<-Total.DOC.files[i]
  colnames(data)<-c("Tank", "DOC..mg.L", "TN..mg.L", "File")
  data$Tank<- IDs$Tank
  data$Tank<-as.numeric(as.character(data$Tank)) # make the column of samples all numeric
  data <- data[!is.na(as.numeric(as.character(data$Tank))),] # remove all rows that aren't numeric/tanks
  data$Treatment<-IDs$Treatment
  data$plant.mass..g<-IDs$plant.mass..g
  make.names(assign(paste(file.names[i], sep=""), data)) # make the file name the name of new df for loop df
  }
########## this is the end of the loop


ls() #see all dfs you've made, the above will be df matching their file names

#Combine files from loop to single df
DOC.df<-rbind(DOC_T0, DOC_T1, DOC_T2, DOC_T3, DOC_T4)

DOC.df$File <- sapply(strsplit(DOC.df$File, "/"), `[`, 3) # extract sample names

# alternative way to code teh above
#give the 10th-24th character of the file name, removing the rest
#DOC.df$File<-substr(DOC.df$File, 13, 27) 

#alternatively
# remove the 9 letters ('^.) at start 
# remove the 4 letters (.$') at end
#DOC.df$File<-gsub('^.........|....$', '', DOC.df$File) 

# if equals DOC_T0_11052021 then, T0, if not then T1
DOC.df$Time.point<- as.factor(ifelse(DOC.df$File=="DOC_T0.csv", "T0",
         ifelse (DOC.df$File=="DOC_T1.csv", "T1",
           ifelse (DOC.df$File=="DOC_T2.csv", "T2", 
                   ifelse(DOC.df$File=="DOC_T3.csv", "T3", "T4")))))

#rearrange
DOC.df<- DOC.df %>% 
  select(File, Time.point, Treatment, Tank, plant.mass..g, DOC..mg.L, TN..mg.L) 

```

DOC plots
```{r}
DOC.T0<-ggplot(DOC.df[(DOC.df$Time.point=="T0"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-0") +
  ylab("DOC (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

DOC.T1<-ggplot(DOC.df[(DOC.df$Time.point=="T1"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-1") +
  ylab("DOC (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting
  
DOC.T2<-ggplot(DOC.df[(DOC.df$Time.point=="T2"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-2") +
  ylab("DOC (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

  
DOC.T3<-ggplot(DOC.df[(DOC.df$Time.point=="T3"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-3") +
  ylab("DOC (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

DOC.T4<-ggplot(DOC.df[(DOC.df$Time.point=="T4"),], aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 60)) +
  ggtitle("Time-4") +
  ylab("DOC (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

DOC.plots<-plot_grid(
  DOC.T0+ theme(legend.position = "none"),
  DOC.T1+ theme(legend.position = "none"),
  DOC.T2+ theme(legend.position = "none"),
  DOC.T3+ theme(legend.position = "none"),
  DOC.T4+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8, 8, 3), ncol=6)


DOC.plots

ggsave("figures/DOC.pdf", height=5, width=12)

```

Total N plots
```{r}
TN.T0<-ggplot(DOC.df[(DOC.df$Time.point=="T0"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("Time-0") +
  ylab("TN (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting
 
TN.T1<-ggplot(DOC.df[(DOC.df$Time.point=="T1"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("Time-1") +
  ylab("TN (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

TN.T2<-ggplot(DOC.df[(DOC.df$Time.point=="T2"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("Time-2") +
  ylab("TN (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

TN.T3<-ggplot(DOC.df[(DOC.df$Time.point=="T3"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("Time-3") +
  ylab("TN (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting

TN.T4<-ggplot(DOC.df[(DOC.df$Time.point=="T4"),], aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("Time-4") +
  ylab("TN (mg/L)") +
  xlab("plant material (g)") +
  Fig.formatting
  
TN.plots<-plot_grid(
  TN.T0+ theme(legend.position = "none"),
  TN.T1+ theme(legend.position = "none"),
  TN.T2+ theme(legend.position = "none"),
  TN.T3+ theme(legend.position = "none"),
  TN.T4+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,8,3), ncol=6)

ggsave("figures/TN.pdf", height=5, width=18)

```


### UV/BIO DOC

```{r}

##### grab files in a list
UVBio.files <- list.files(path="data/UVBIO", pattern = "csv$", full.names = T)
UVBio.files

##### what are the file names, sans extensions using package 'tools'
file.names<-file_path_sans_ext(list.files(path="data/UVBIO", pattern = "csv$", full.names = F))
file.names


############ formatting all data in for loop
  for(i in 1:length(UVBio.files))
    {
  data<-read.csv(UVBio.files[i], sep=",") #skip 13 rows where standards are
  data<-data[,c(1,3,4)] # removed columns we don't need
  data$File<-UVBio.files[i]
  colnames(data)<-c("Tank", "DOC..mg.L", "TN..mg.L", "File") 
  data$Tank<-as.character(data$Tank)
  data$Treatment<-IDs$Treatment # add treatment info
  data$plant.mass..g<-IDs$plant.mass..g # add plant biomass info
  make.names(assign(paste(file.names[i], sep=""), data)) # make the file name the name of new df for loop df
  }
########## this is the end of the loop


ls() #see all dfs you've made, the above will be df matching their file names



#Combine files from loop to single df
UVBIO.df<-rbind(DOC_NoUV_T1, DOC_UV_T1, DOC_NoUV_T2, DOC_UV_T2, DOC_NoUV_T3, DOC_UV_T3)

# make new factors for filtered (F/NF) and UV (+/-)
# ** caution! Make sure this matches sheet layout after the loop!

UVBIO.df$Filter.Trt<-rep(c("Filtered", "Unfiltered"), each=30) # repeat 30 times
UVBIO.df$UV.Trt<-rep(c("NoUV", "UV"), each=60) # repeat 60 times

# check tank names in DF and make sure they are what you think they are (i.e 1-30 but w/ weird names)
Tank.fix<-rep(c(1:30), times=12) # repeat 12 times to fix all the strange tank names 

#compare tank IDS
df.test<-cbind(Tank.fix, UVBIO.df$Tank) # yep!

UVBIO.df$Tank<-as.factor(Tank.fix) #replace old tank names

# extract out the file names
UVBIO.df$File <- sapply(strsplit(UVBIO.df$File, "/"), `[`, 3) # extract sample names
UVBIO.df$DOC..mg.L<-gsub("NPOC:","", UVBIO.df$DOC..mg.L)
UVBIO.df$DOC..mg.L<- gsub("mg/L", "", UVBIO.df$DOC..mg.L)
UVBIO.df$TN..mg.L<-gsub("TN:","", UVBIO.df$TN..mg.L)
UVBIO.df$TN..mg.L<- gsub("mg/L", "", UVBIO.df$TN..mg.L)

#convert DOC and TN to numeric
UVBIO.df$DOC..mg.L<-as.numeric(as.character(UVBIO.df$DOC..mg.L))
UVBIO.df$TN..mg.L<- as.numeric(as.character(UVBIO.df$TN..mg.L))


# add a time point
# if equals DOC_UV_T1_111721 then, T1, if not then "nothing"
UVBIO.df$Time.point<- as.factor(ifelse(UVBIO.df$File=="DOC_UV_T1.csv", "T1",
  ifelse(UVBIO.df$File=="DOC_NoUV_T1.csv", "T1",
          ifelse(UVBIO.df$File=="DOC_UV_T2.csv", "T2",
                ifelse(UVBIO.df$File=="DOC_NoUV_T2.csv", "T2", "T3")))))

#rearrange
UVBIO.df<- UVBIO.df %>% 
  select(File, Time.point, Treatment, Filter.Trt, UV.Trt, Tank, plant.mass..g, DOC..mg.L, TN..mg.L)


# make levels for plotting and stats
# add in starting DOC and TN
# original data is... DOC_T0, DOC_T1, DOC_T2, DOC_T3, DOC_T4 -- but no need for DOC T0 and T4
# repeat 4x to account for the 4 treatments in each tank
DOC_T1.start<-rep(DOC_T1$DOC..mg.L, times=4)
DOC_T2.start<-rep(DOC_T2$DOC..mg.L, times=4)
DOC_T3.start<-rep(DOC_T3$DOC..mg.L, times=4)

TN_T1.start<-rep(DOC_T1$TN..mg.L, times=4)
TN_T2.start<-rep(DOC_T2$TN..mg.L, times=4)
TN_T3.start<-rep(DOC_T3$TN..mg.L, times=4)

# compile and add in as a new column
UVBIO.df$Start.DOC<-c(DOC_T1.start, DOC_T2.start, DOC_T3.start)
UVBIO.df$Start.TN<-c(TN_T1.start, TN_T2.start, TN_T3.start)

```
  
Process the UVBio and get ready for plotting
```{r}
UVBIO.df$Burn.Filt.UV<-interaction(UVBIO.df$Treatment, UVBIO.df$Filter.Trt, UVBIO.df$UV.Trt)
UVBIO.df$Filt.UV<-interaction(UVBIO.df$Filter.Trt, UVBIO.df$UV.Trt)

# correct to make factor levels
UVBIO.df$Filter.Trt<-as.factor(UVBIO.df$Filter.Trt)
UVBIO.df$UV.Trt <-as.factor(UVBIO.df$UV.Trt)

# make new variables
# (1) change in DOC over the 7d incubation
UVBIO.df$change.DOC<- UVBIO.df$DOC..mg.L - UVBIO.df$Start.DOC # final value (lower) - start
UVBIO.df$change.TN<-  UVBIO.df$TN..mg.L - UVBIO.df$Start.TN 

# (1) % change in DOC over the 7d incubation
UVBIO.df<-mutate (UVBIO.df, percent.change.DOC=((UVBIO.df$DOC..mg.L - UVBIO.df$Start.DOC)/Start.DOC)*100)
UVBIO.df<-mutate (UVBIO.df, percent.change.TN=((UVBIO.df$TN..mg.L - UVBIO.df$Start.TN)/Start.TN)*100)

```
Plot the UV Bio as % change, using the values of the tank DOC at deployment as start DOC, then the values of DOC after 7d as the final. Get the difference (start-end, should be a negative if values decline over incubation), then make a % by dividing by the start values of DOC.
  
  
Time 1 UV-BIO
```{r}
# make some plotting datafames
UVBIO.df<-UVBIO.df[!(UVBIO.df$percent.change.DOC>=40),]
UVBIO.df<-UVBIO.df[!(UVBIO.df$percent.change.DOC<=-100),]


# all data frames by time
UVBIO.df.T1<-UVBIO.df[(UVBIO.df$Time.point=="T1"),]
UVBIO.df.T2<-UVBIO.df[(UVBIO.df$Time.point=="T2"),]
UVBIO.df.T3<-UVBIO.df[(UVBIO.df$Time.point=="T3"),]

# these are all separated by the 4 incubation treatment levels
Filt.UV.T1 <-UVBIO.df.T1[UVBIO.df.T1$Filter.Trt=="Filtered" & UVBIO.df.T1$UV.Trt=="UV",]
Filt.NoUV.T1<-UVBIO.df.T1[(UVBIO.df.T1$Filter.Trt=="Filtered" & UVBIO.df.T1$UV.Trt=="NoUV"),]
NFilt.UV.T1 <-UVBIO.df.T1[UVBIO.df.T1$Filter.Trt=="Unfiltered" & UVBIO.df.T1$UV.Trt=="UV",]
NFilt.NoUV.T1 <-UVBIO.df.T1[UVBIO.df.T1$Filter.Trt=="Unfiltered" & UVBIO.df.T1$UV.Trt=="NoUV",]

## Time 1 plots
Filt.UV.T1.plot<-ggplot(
  Filt.UV.T1, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: -Bio, +UV") +
  coord_cartesian(ylim=c(-40, 60)) +
  ylab(expression(paste("%", Delta, " DOC mg/L"))) +
  xlab("plant material (g)")  +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

Filt.NoUV.T1.plot<-ggplot(
  Filt.NoUV.T1, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: -Bio, +UV") +
  coord_cartesian(ylim=c(-40, 60)) +
  ylab(expression(paste("%", Delta, " DOC mg/L"))) +
  xlab("plant material (g)")  +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

NFilt.UV.T1.plot<-ggplot(
  NFilt.UV.T1, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: -Bio, +UV") +
  coord_cartesian(ylim=c(-40, 60)) +
  ylab(expression(paste("%", Delta, " DOC mg/L"))) +
  xlab("plant material (g)")  +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

NFilt.NoUV.T1.plot<-ggplot(
  NFilt.NoUV.T1, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: -Bio, +UV") +
  coord_cartesian(ylim=c(-40, 60)) +
  ylab(expression(paste("%", Delta, " DOC mg/L"))) +
  xlab("plant material (g)")  +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

UVBio.T1<-plot_grid(
  Filt.UV.T1.plot+ theme(legend.position = "none"), 
  Filt.NoUV.T1.plot+ theme(legend.position = "none"),
  NFilt.UV.T1.plot+ theme(legend.position = "none"),
  NFilt.NoUV.T1.plot+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

UVBio.T1

ggsave("figures/UVBio.T1.pdf", height=6, width=14)

```
  
  Time 2 UV-BIO
```{r}

# these are all separated by the 4 incubation treatment levels
Filt.UV.T2 <-UVBIO.df.T2[UVBIO.df.T2$Filter.Trt=="Filtered" & UVBIO.df.T2$UV.Trt=="UV",]
Filt.NoUV.T2<-UVBIO.df.T2[(UVBIO.df.T2$Filter.Trt=="Filtered" & UVBIO.df.T2$UV.Trt=="NoUV"),]
NFilt.UV.T2 <-UVBIO.df.T2[UVBIO.df.T2$Filter.Trt=="Unfiltered" & UVBIO.df.T2$UV.Trt=="UV",]
NFilt.NoUV.T2 <-UVBIO.df.T2[UVBIO.df.T2$Filter.Trt=="Unfiltered" & UVBIO.df.T2$UV.Trt=="NoUV",]

## Time 1 plots
Filt.UV.T2.plot<-ggplot(Filt.UV.T2, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: -Bio, +UV") +
  coord_cartesian(ylim=c(-50, 50)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting


Filt.NoUV.T2.plot<-ggplot(
  Filt.NoUV.T2, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: -Bio, -UV") +
  coord_cartesian(ylim=c(-50, 50)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

NFilt.UV.T2.plot<-ggplot(
  NFilt.UV.T2, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: +Bio, +UV") +
  coord_cartesian(ylim=c(-50, 50)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)")  +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

NFilt.NoUV.T2.plot<-ggplot(
  NFilt.NoUV.T2, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: +Bio, -UV") +
  coord_cartesian(ylim=c(-50, 50)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

UVBio.T2<-plot_grid(
  Filt.UV.T2.plot+ theme(legend.position = "none"), 
  Filt.NoUV.T2.plot+ theme(legend.position = "none"),
  NFilt.UV.T2.plot+ theme(legend.position = "none"),
  NFilt.NoUV.T2.plot+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

ggsave("figures/UVBio.T2.pdf", height=6, width=14)

```
  
   Time 3 UV-BIO
```{r}

# these are all separated by the 4 incubation treatment levels
Filt.UV.T3 <-UVBIO.df.T3[UVBIO.df.T3$Filter.Trt=="Filtered" & UVBIO.df.T3$UV.Trt=="UV",]
Filt.NoUV.T3<-UVBIO.df.T3[(UVBIO.df.T3$Filter.Trt=="Filtered" & UVBIO.df.T3$UV.Trt=="NoUV"),]
NFilt.UV.T3 <-UVBIO.df.T3[UVBIO.df.T3$Filter.Trt=="Unfiltered" & UVBIO.df.T3$UV.Trt=="UV",]
NFilt.NoUV.T3 <-UVBIO.df.T3[UVBIO.df.T3$Filter.Trt=="Unfiltered" & UVBIO.df.T3$UV.Trt=="NoUV",]

## Time 3 plots
Filt.UV.T3.plot<-ggplot(
  Filt.UV.T3, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: -Bio, +UV") +
  coord_cartesian(ylim=c(-20, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

Filt.NoUV.T3.plot<-ggplot(
  Filt.NoUV.T3, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: -Bio, -UV") +
  coord_cartesian(ylim=c(-20, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

NFilt.UV.T3.plot<-ggplot(
  NFilt.UV.T3, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: +Bio, +UV") +
  coord_cartesian(ylim=c(-20, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

NFilt.NoUV.T3.plot<-ggplot(
  NFilt.NoUV.T3, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: +Bio, -UV") +
  coord_cartesian(ylim=c(-20, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)")  +
  scale_y_continuous(name = expression(paste("%", Delta, " DOC mg/L")), sec.axis = sec_axis( trans=~.*1, name="Initial DOC mg/L")) +
  geom_line( aes(y=Start.DOC), size=1, linetype= "twodash") +
  Fig.formatting

UVBio.T3<-plot_grid(
  Filt.UV.T3.plot+ theme(legend.position = "none"), 
  Filt.NoUV.T3.plot+ theme(legend.position = "none"),
  NFilt.UV.T3.plot+ theme(legend.position = "none"),
  NFilt.NoUV.T3.plot+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

ggsave("figures/UVBio.T3.pdf", height=6, width=14)

#compile all plots
all.UV.Bio<-plot_grid(
  UVBio.T1, 
  UVBio.T2,
  UVBio.T3,
  ncol=1)

ggsave("figures/all.UV.Bio.pdf", height=10, width=14)

```
  
- Instead of the % see how UV Bio looks if you plot the absolute change in DOC  instead of the % change. Use the column "change.DOC" here.

Time 1 UV-BIO as absolute change
```{r}
#Timepoint 1
Filt.UV.T1.plot<-ggplot(
  Filt.UV.T1, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: -Bio, +UV") +
  coord_cartesian(ylim=c(-8, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting


Filt.NoUV.T1.plot<-ggplot(
  Filt.NoUV.T1, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: -Bio, -UV") +
  coord_cartesian(ylim=c(-8, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

NFilt.UV.T1.plot<-ggplot(NFilt.UV.T1, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: +Bio, +UV") +
  coord_cartesian(ylim=c(-8, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)")+
  Fig.formatting

NFilt.NoUV.T1.plot<-ggplot(
  NFilt.NoUV.T1, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T1: +Bio, -UV") +
  coord_cartesian(ylim=c(-8, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)")+
  Fig.formatting


UVBio.T1<-plot_grid(
  Filt.UV.T1.plot+ theme(legend.position = "none"), 
  Filt.NoUV.T1.plot+ theme(legend.position = "none"),
  NFilt.UV.T1.plot+ theme(legend.position = "none"),
  NFilt.NoUV.T1.plot+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

ggsave("figures/UVBio.T1_abs.change.pdf", height=6, width=11)

```
 
Time 2 UV-BIO as absolute change
```{r}
## Time 1 plots
Filt.UV.T2.plot<-ggplot(Filt.UV.T2, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: -Bio, +UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

Filt.NoUV.T2.plot<-ggplot(
  Filt.NoUV.T2, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: -Bio, -UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

NFilt.UV.T2.plot<-ggplot(
  NFilt.UV.T2, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: +Bio, +UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

NFilt.NoUV.T2.plot<-ggplot(
  NFilt.NoUV.T2, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T2: +Bio, -UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

UVBio.T2<-plot_grid(
  Filt.UV.T2.plot+ theme(legend.position = "none"), 
  Filt.NoUV.T2.plot+ theme(legend.position = "none"),
  NFilt.UV.T2.plot+ theme(legend.position = "none"),
  NFilt.NoUV.T2.plot+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

ggsave("figures/UVBio.T2_abs.change.pdf", height=6, width=11)

```
  
Time 3 UV-BIO as absolute change
```{r}

## Time 3 plots
Filt.UV.T3.plot<-ggplot(
  Filt.UV.T3, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: -Bio, +UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

Filt.NoUV.T3.plot<-ggplot(
  Filt.NoUV.T3, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: -Bio, -UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

NFilt.UV.T3.plot<-ggplot(
  NFilt.UV.T3, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: +Bio, +UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

NFilt.NoUV.T3.plot<-ggplot(
  NFilt.NoUV.T3, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("T3: +Bio, -UV") +
  coord_cartesian(ylim=c(-5, 5)) +
  ylab(expression(paste(Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

UVBio.T3<-plot_grid(
  Filt.UV.T3.plot+ theme(legend.position = "none"), 
  Filt.NoUV.T3.plot+ theme(legend.position = "none"),
  NFilt.UV.T3.plot+ theme(legend.position = "none"),
  NFilt.NoUV.T3.plot+ theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

ggsave("figures/UVBio.T3_abs.change.pdf", height=6, width=11)

#compile all plots
all.UV.Bio<-plot_grid(
  UVBio.T1, 
  UVBio.T2,
  UVBio.T3,
  ncol=1)

ggsave("figures/all.UV.Bio_abs.change.pdf", height=10, width=11)

```
  
  
  
  
  
Older pot attempts below


- plots of 2: % change of DOC
```{r}

UV.TRT.plot<-ggplot(UVBIO.df.T1, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment, linetype=UV.Trt), alpha=0.1) +
  ggtitle("No-UV vs. UV") +
  coord_cartesian(ylim=c(-5, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

FILTER.TRT.plot<-ggplot(UVBIO.df, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  scale_linetype_manual(values=c("solid", "twodash")) +
  geom_smooth(method=loess, aes(fill=Treatment, linetype=Filter.Trt), alpha=0.1) +
  ggtitle("Filtered vs. Unfiltered") +
  coord_cartesian(ylim=c(-5, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting


##### combine
UVBio.plots2<-plot_grid(
  UV.TRT.plot,
  FILTER.TRT.plot,  ncol=2)

ggsave("figures/UVBio.plots.percent2.pdf", height=5, width=9)

```

- another take on the UV-BIO separated by burning treatment
```{r}
UV.TRT.B.plot<-ggplot(UVBIO.df[(UVBIO.df$Treatment=="burned"),], 
                       aes(x=plant.mass..g, y=percent.change.DOC, color=Filt.UV)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("coral", "yellowgreen", "peru", "seagreen")) + 
  scale_fill_manual(values = c("coral", "yellowgreen", "peru", "seagreen")) +
  geom_smooth(method=loess, aes(fill=Filt.UV), alpha=0.1) +
  ggtitle("Unburned") +
  coord_cartesian(ylim=c(-5, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

UV.TRT.UB.plot<-ggplot(UVBIO.df[(UVBIO.df$Treatment=="unburned"),], 
                       aes(x=plant.mass..g, y=percent.change.DOC, color=Filt.UV)) + 
  geom_point(alpha=0.5) +
  scale_color_manual(values = c("coral", "yellowgreen", "peru", "seagreen")) + 
  scale_fill_manual(values = c("coral", "yellowgreen", "peru", "seagreen")) +
  geom_smooth(method=loess, aes(fill=Filt.UV), alpha=0.1) +
  ggtitle("Burned") +
  coord_cartesian(ylim=c(-5, 40)) +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting


extract.legend2 <- get_legend(
  # create some space to the left of the legend
  UV.TRT.UB.plot + theme(legend.box.margin = margin(0, 0, 0, 10)))

NFilt.NoUV <-UVBIO.df[UVBIO.df$Filter.Trt=="Unfiltered" & UVBIO.df$UV.Trt=="NoUV",]


##### combine
UVBio.plots3<-plot_grid(
  UV.TRT.B.plot + theme(legend.position = "none"),
  UV.TRT.UB.plot + theme(legend.position = "none"),
  extract.legend2,
  rel_widths = c(8,8,3), ncol=3)



ggsave("figures/UVBio.plots.percent3.pdf", height=5, width=9)


```

- plot of 4: UV-BIO as % change in DOC
```{r}
################## plots for total DOC concentration over incubation period

# filtered UV plot
Filt.UV.fig<-ggplot(Filt.UV, aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:UV") +
  ylab(expression(paste(" DOC mg/L"))) +
  xlab("plant material (g)") 

# filtered NoUV plot
F.NoUV.fig<-ggplot(Filt.NoUV, aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:NoUV") +
  ylab(expression(paste("DOC mg/L"))) +
  xlab("plant material (g)") 


# nofiltered UV plot
NFilt.UV.fig<-ggplot(NFilt.UV, aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:UV") +
  ylab(expression(paste("DOC mg/L"))) +
  xlab("plant material (g)") 


# nofiltered NoUV plot
NFilt.NoUV.fig<-ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=DOC..mg.L, color=Treatment)) +
  geom_point() +
  facet_wrap(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:NoUV") +
  ylab(expression(paste("DOC mg/L"))) +
  xlab("plant material (g)") 

##### combine
UVBio.DOC.timeseries<-plot_grid(
  Filt.UV.fig + theme(legend.position = "none"),
  F.NoUV.fig + theme(legend.position = "none"),
  NFilt.UV.fig + theme(legend.position = "none"),
  NFilt.NoUV.fig + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

UVBio.DOC.timeseries

ggsave("figures/UVBio.DOC.timeseries.pdf", height=4, width=15)

################## plots for change in DOC over incubation period

# filtered UV plot
change.Filt.UV.fig<-ggplot(Filt.UV, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:UV") +
  ylab(expression(paste(Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 

# filtered NoUV plot
change.F.NoUV.fig<-ggplot(Filt.NoUV, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:NoUV") +
  ylab(expression(paste(Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 


# nofiltered UV plot
change.NFilt.UV.fig<-ggplot(NFilt.UV, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:UV") +
  ylab(expression(paste(Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 


# nofiltered NoUV plot
change.NFilt.NoUV.fig<-ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) +
  geom_point() +
  facet_wrap(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:NoUV") +
  ylab(expression(paste(Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 

##### combine
change.UVBio.DOC<-plot_grid(
  change.Filt.UV.fig + theme(legend.position = "none"),
  change.F.NoUV.fig + theme(legend.position = "none"),
  change.NFilt.UV.fig + theme(legend.position = "none"),
  change.NFilt.NoUV.fig + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

change.UVBio.DOC
ggsave("figures/change.UVBio.DOC.pdf", height=5, width=15)

################## plots for % change in DOC over incubation period

# filtered UV plot
percent.change.Filt.UV.fig<-ggplot(Filt.UV, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:UV") +
  ylab(expression(paste("%", Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 

# filtered NoUV plot
percent.change.F.NoUV.fig<-ggplot(Filt.NoUV, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:NoUV") +
  ylab(expression(paste("%", Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 


# nofiltered UV plot
percent.change.NFilt.UV.fig<-ggplot(NFilt.UV, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:UV") +
  ylab(expression(paste("%", Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 


# nofiltered NoUV plot
percent.change.NFilt.NoUV.fig<-ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) +
  geom_point() +
  facet_wrap(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:NoUV") +
  ylab(expression(paste("%", Delta, "DOC mg/L"))) +
  xlab("plant material (g)") 

##### combine
percent.change.UVBio.DOC<-plot_grid(
  percent.change.Filt.UV.fig + theme(legend.position = "none"),
  percent.change.F.NoUV.fig + theme(legend.position = "none"),
  percent.change.NFilt.UV.fig + theme(legend.position = "none"),
  percent.change.NFilt.NoUV.fig + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

percent.change.UVBio.DOC
ggsave("figures/percent.change.UVBio.DOC.pdf", height=4, width=15)

```


change in TN over incubation period
```{r}

################## plots for TN concentration over incubation period

# filtered UV plot
TN.Filt.UV.fig<-ggplot(Filt.UV, aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:UV") +
  ylab(expression(paste("TN mg/L"))) +
  xlab("plant material (g)") 

# filtered NoUV plot
TN.F.NoUV.fig<-ggplot(Filt.NoUV, aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:NoUV") +
  ylab(expression(paste("TN mg/L"))) +
  xlab("plant material (g)") 


# nofiltered UV plot
TN.NFilt.UV.fig<-ggplot(NFilt.UV, aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:UV") +
  ylab(expression(paste("TN mg/L"))) +
  xlab("plant material (g)") 


# nofiltered NoUV plot
TN.NFilt.NoUV.fig<-ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=TN..mg.L, color=Treatment)) +
  geom_point() +
  facet_wrap(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:NoUV") +
  ylab(expression(paste("TN mg/L"))) +
  xlab("plant material (g)") 

##### combine
TN.UVBio<-plot_grid(
  TN.Filt.UV.fig + theme(legend.position = "none"),
  TN.F.NoUV.fig + theme(legend.position = "none"),
  TN.NFilt.UV.fig + theme(legend.position = "none"),
  TN.NFilt.NoUV.fig + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

TN.UVBio
ggsave("figures/TN.UVBio.pdf", height=4, width=15)

################## plots for change in TN over incubation period

# filtered UV plot
change.TN.Filt.UV.fig<-ggplot(Filt.UV, aes(x=plant.mass..g, y=change.TN, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:UV") +
  ylab(expression(paste(Delta, "TN mg/L"))) +
  xlab("plant material (g)") 

# filtered NoUV plot
change.TN.F.NoUV.fig<-ggplot(Filt.NoUV, aes(x=plant.mass..g, y=change.TN, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:NoUV") +
  ylab(expression(paste(Delta, "TN mg/L"))) +
  xlab("plant material (g)") 


# nofiltered UV plot
change.TN.NFilt.UV.fig<-ggplot(NFilt.UV, aes(x=plant.mass..g, y=change.TN, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:UV") +
  ylab(expression(paste(Delta, "TN mg/L"))) +
  xlab("plant material (g)") 


# nofiltered NoUV plot
change.TN.NFilt.NoUV.fig<-ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=change.TN, color=Treatment)) +
  geom_point() +
  facet_wrap(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:NoUV") +
  ylab(expression(paste(Delta, "TN mg/L"))) +
  xlab("plant material (g)") 

##### combine
change.TN.UVBio<-plot_grid(
  change.TN.Filt.UV.fig + theme(legend.position = "none"),
  change.TN.F.NoUV.fig + theme(legend.position = "none"),
  change.TN.NFilt.UV.fig + theme(legend.position = "none"),
  change.TN.NFilt.NoUV.fig + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

change.TN.UVBio
ggsave("figures/change.TN.UVBio.pdf", height=4, width=15)

################## plots for % change in TN over incubation period

# filtered UV plot
percent.change.TN.Filt.UV.fig<-ggplot(Filt.UV, aes(x=plant.mass..g, y=percent.change.TN, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:UV") +
  ylab(expression(paste("%", Delta, "TN mg/L"))) +
  xlab("plant material (g)") 

# filtered NoUV plot
percent.change.TN.F.NoUV.fig<-ggplot(Filt.NoUV, aes(x=plant.mass..g, y=percent.change.TN, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("Filt:NoUV") +
  ylab(expression(paste("%", Delta, "TN mg/L"))) +
  xlab("plant material (g)") 


# nofiltered UV plot
percent.change.TN.NFilt.UV.fig<-ggplot(NFilt.UV, aes(x=plant.mass..g, y=percent.change.TN, color=Treatment)) + 
  geom_point() +
   facet_grid(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:UV") +
  ylab(expression(paste("%", Delta, "TN mg/L"))) +
  xlab("plant material (g)") 


# nofiltered NoUV plot
percent.change.TN.NFilt.NoUV.fig<-ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=percent.change.TN, color=Treatment)) +
  geom_point() +
  facet_wrap(.~ Time.point) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ggtitle("NoFilt:NoUV") +
  ylab(expression(paste("%", Delta, "TN mg/L"))) +
  xlab("plant material (g)") 

##### combine
percent.change.TN.UVBio<-plot_grid(
  percent.change.TN.Filt.UV.fig + theme(legend.position = "none"),
  percent.change.TN.F.NoUV.fig + theme(legend.position = "none"),
  percent.change.TN.NFilt.UV.fig + theme(legend.position = "none"),
  percent.change.TN.NFilt.NoUV.fig + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(8,8,8,8,3), ncol=5)

percent.change.TN.UVBio
ggsave("figures/percent.change.TN.UVBio.pdf", height=4, width=15)


```







This chunk looks at different statistics:

```{r}

##### Looking at the relationship between DOC types (D or UD)
# Read the file
Dilute<-read.csv("data/DOC.Dilutions/UndilutedvsDiluted.csv")
              
#Graph for SD and CV vs. biomass
SD_dilute<- ggplot(Dilute, aes(x=plant.mass..g, y=STDEV, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("STDEV between samples") +
  ylab("STDEV") +
  xlab("plant material (g)") +
  Fig.formatting

CV_dilute<- ggplot(Dilute, aes(x=plant.mass..g, y=CV, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(0, 2)) +
  ggtitle("CV between samples") +
  ylab("CV") +
  xlab("plant material (g)") +
  Fig.formatting

Dilute_plots <- plot_grid(
  SD_dilute + theme(legend.position = "none"),
  CV_dilute + theme(legend.position = "none"),
  extract.legend, 
  rel_widths = c(9,9,3), ncol=3)
Dilute_plots

ggsave("figures/Dilute.plots.pdf", height=4, width=8)


```



```{r}

# nofiltered UV plot
ggplot(NFilt.UV, aes(x=plant.mass..g, y=change.DOC, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(-5, 40)) +
  ggtitle("T1: NoFilt:UV") +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting

lm_y <- lm(change.DOC~ plant.mass..g, data = NFilt.UV)
summary(lm_y)

plot(lm_y, which = 1)

# nofiltered NoUV plot
ggplot(NFilt.NoUV, aes(x=plant.mass..g, y=percent.change.DOC, color=Treatment)) + 
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  coord_cartesian(ylim=c(-5, 40)) +
  ggtitle("T1: NoFilt:NoUV") +
  ylab(expression(paste("% ", Delta, " DOC mg/L"))) +
  xlab("plant material (g)") +
  Fig.formatting



```

### Isotopes
```{r, isotopes}

topes<-read.csv("data/Isotopes/Time1_isotopes_pyromania.csv")
topes.trt<-topes[(topes$Treatment=="burned" | topes$Treatment=="unburned"),]
topes.controls<-topes[!(topes$Treatment=="burned" | topes$Treatment=="unburned"),]

#### isotope plots for treatments
iso.plot<-ggplot(topes.trt, 
                 aes(x=plant.mass..g, y=d15N, color=Treatment, shape=Type, linetype=Type)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab(expression(paste(delta^{15}, N, " (\u2030, air)"))) +
  xlab("plant material (g)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))

iso.plot
ggsave("figures/iso.plot.pdf", encod="MacRoman", height=5, width=6)


############# C vs N plot
iso.plot.CN<-ggplot(topes.trt,aes(x=Total.C..ug, y=Total.N..ug, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab("Total N (ug)") +
  xlab("Total C (ug)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))

iso.plot.CN
ggsave("figures/iso.plot.pdf", encod="MacRoman", height=5, width=6)


######### C:N ratio plot by biomass
topes.trt$CN <-topes.trt$Total.C..ug/topes.trt$Total.N..ug

iso.plot.CNratio<-ggplot(topes.trt, aes(y=C.N, x=plant.mass..g, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab("C:N") +
  xlab("plant material (g)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))

iso.plot.CNratio
ggsave("figures/iso.plot.CNratio.pdf", encod="MacRoman", height=5, width=6)


########## POM only
iso.plot.CN.POM<-ggplot(topes.trt[(topes.trt$Type=="POM"),], 
                         aes(y=C.N, x=plant.mass..g, color=Treatment)) +
  geom_point() +
  ggtitle("POM")+ 
  coord_cartesian(ylim=c(0, 16)) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab("C:N") +
  xlab("plant material (g)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))

######## Plankton
iso.plot.CN.Plank<-ggplot(topes.trt[(topes.trt$Type=="plankton"),], 
                         aes(y=C.N, x=plant.mass..g, color=Treatment)) +
  geom_point() +
  ggtitle("plankton")+
  coord_cartesian(ylim=c(0, 16)) +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab("C:N") +
  xlab("plant material (g)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))

## combine plots
isoCNplot<- plot_grid(iso.plot.CN.POM + theme(legend.position = "none"), 
                    iso.plot.CN.Plank + theme(legend.position = "none"),
                    extract.legend, rel_widths = c(8,8,3), ncol=3)

isoCNplot
ggsave("figures/iso.plot.CN.POM.Plank.pdf", encod="MacRoman", height=5, width=10)



#### C by biomass plot
iso.plot.C<-ggplot(topes.trt, aes(x=plant.mass..g, y=Total.C..ug, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab("Total C (ug)") +
  xlab("plant material (g)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))

#### N by biomass plot
iso.plot.N<-ggplot(topes.trt, aes(x=plant.mass..g, y=Total.N..ug, color=Treatment)) +
  geom_point() +
  scale_color_manual(values = c("brown1", "mediumseagreen")) + 
  geom_smooth(method=loess, aes(fill=Treatment), alpha=0.1) +
  ylab("Total C (ug)") +
  xlab("plant material (g)") +
  Fig.formatting +
  theme(legend.key.size = unit(2,"line"))



########## ########## ########## 
########## control plots

#make some summaries for the controls
iso.contr.means<-aggregate(d15N~ Type, topes.controls, mean)
iso.contr.sd<-aggregate(d15N~ Type, topes.controls, sd)

iso.cont.df<-cbind(iso.contr.means,iso.contr.sd[2])
colnames(iso.cont.df)<-c("Type", "d15N", "SD")
pd<-position_dodge(0.71) #offset for error bars

iso.cont.df$Type<-factor(iso.cont.df$Type, 
                         levels=c("blank", "plankton.stock", 
                                  "willow.unburned", "willow.burned",
                                  "sage.unburned", "sage.burned", 
                                  "sage.veryburned", "sage.stem.burned"))


iso.plot.control<-ggplot(data=iso.cont.df,  aes(x=Type, y=d15N, fill=Type)) +
  geom_bar(stat="identity") +
  geom_errorbar(aes(ymin=d15N-SD, ymax=d15N+SD),size=.5, width=0, position=pd)+
  ylab(expression(paste(delta^{15}, N, " (\u2030, air)"))) +
  scale_fill_manual(values = c("azure2", "cornflowerblue",
                                "darkgoldenrod1", "darkgoldenrod",
                                "darkseagreen3", "darkolivegreen3",
                                "darkolivegreen4", "darkgreen")) +
  xlab("control types") +  Fig.formatting +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

iso.plot.control
ggsave("figures/iso.plot_controls.pdf", encod="MacRoman", height=5, width=6)





```

